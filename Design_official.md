[TOC]

# BrainStorm 知识竞赛系统设计文档

## 1 版本历史

| 日期     | 版本  | 人员           | 更新内容                       |
| -------- | ----- | -------------- | ------------------------------ |
| 22.03.26 | v0.0  | 赵子涵         | 创建文档及目录; 编写文档介绍.  |
| 22.03.28 | v0.01 | 李昀泽         | 编辑功能 A 目录                |
| 22.03.28 | v0.02 | 刘硕           | 编写 A1 功能，修改功能 A 目录  |
| 22.03.28 | v0.03 | 李昀泽         | 编写 A2、A3、A4 功能           |
| 22.03.28 | v0.04 | 刘硕           | 编写 A5 功能，修改 A1 功能     |
| 22.03.29 | v0.05 | 黄辰麟         | 编写 A7 功能，编写 A8 功能     |
| 22.03.30 | v0.06 | 张瑞轩         | 编写接口设计相关内容           |
| 22.03.30 | v0.07 | 赵子涵         | 修改接口路由结构               |
| 22.03.30 | v0.08 | 黄辰麟         | 编写 C1 功能，修改 A7 A8 功能  |
| 22.04.01 | v0.09 | 李昀泽         | 修改 A2 功能                   |
| 22.04.01 | v0.10 | 李昀泽         | 编写功能 B 目录                |
| 22.04.05 | v0.11 | 李昀泽         | 编写 B1~B6 功能                |
| 22.04.05 | v0.12 | 刘东泽         | 编写 A6 功能                   |
| 22.04.06 | v0.13 | 刘硕           | 编写 D2~D7 功能                |
| 22.04.06 | v0.14 | 赵子涵         | 添加类图, 编写 D1 功能逻辑     |
| 22.04.07 | v0.15 | 刘昀鑫、黄辰麟 | 编写 D8、D9 功能               |
| 22.04.08 | v0.16 | 李昀泽         | 修改 B3~B5 功能异常处理        |
| 22.04.08 | v0.17 | 刘硕           | 合并 D4、D5 功能               |
| 22.04.11 | v0.18 | 黄辰麟         | 合并 A7、A8 功能，补全功能描述 |
| 22.04.12 | v0.19 | 李昀泽         | 添加管理端部分接口信息         |
| 22.04.13 | v0.20 | 刘硕           | 补充 A5、D5 界面设计           |

## 2 概述

### 2.1 文档概述

本文档是由 BrainStorm 团队编写, 为 BrainStorm 知识竞赛系统编写的设计文档. 服务于使用和开发本系统的各种人群, 和执行评审的软工课程组.

文档定义了开发结构, 对逻辑分类的各个功能具体描述了界面设计, 接口设计和数据库设计.

望本文能带领读者了解系统的设计细节, 给开发人员提供明确的指导.

### 2.2 开发概述

配合开源开发框架 Django , 采用经典的三层架构, 即表示层, 逻辑层, 和数据访问层.

表示层又分为用户端和管理端, 和逻辑层用团队定义的接口交互. 逻辑层和数据访问层的交互主要使用 Django 提供的 ORM 接口.

基于此, 本团队基本开发流程如下图所示.

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\Dev_flowchart.png" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 2.2.1 项目开发流程	<!--标题-->
    </center>
</div>

## 3 用户信息管理功能(A)

| 子功能名称                     | 子功能代号 | 描述                                                                                                                     |
| ------------------------------ | ---------- | ------------------------------------------------------------------------------------------------------------------------ |
| 管理员账号登录功能             | A1         | （超级）管理员填写账号密码进行登录。                                                                                     |
| 创建、删除管理员账号功能       | A2         | 由超级管理员创建管理员账号并设定初始密码，管理员可自行修改个人密码。超级管理员可以删除管理员账号，但不能删除自己的账号。 |
| 重置管理员密码功能             | A3         | 超级管理员可将管理员密码重置为默认密码                                                                                   |
| （超级）管理员信息查询功能     | A4         | （超级）管理员可直接浏览系统中所有管理员的信息，并可按（超级）管理员用户名进行查询                                       |
| 微信小程序用户信息查询功能     | A5         | （超级）管理员可直接浏览所有小程序用户的信息，并支持根据用户名进行筛选                                                   |
| （超级）管理员个人信息修改功能 | A6         | （超级）管理员可在个人中心对个人信息进行修改                                                                             |
| 小程序用户管理个人信息         | A7         | 用户管理小程序用户信息                                                                                                   |

### 3.1 功能 A1 实现

#### 3.1.1 功能简述

管理端支持（超级）管理员登录和登出功能。登录时需验证用户名和密码，前端对是否输入信息进行验证，如输入框失去焦点后无信息存留，则提示输入信息。如输入的用户名和密码信息正确则进入系统，否则给出错误信息提示。登出时，点击系统顶栏“退出登录”按钮，系统提示登录失效/已退出账号，并跳转到登录界面。

#### 3.1.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\A1_login.png" alt="login" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 3.1.2 （超级）管理员登录（左）和登出（右）流程图	<!--标题-->
    </center>
</div>

#### 3.1.3 用户界面设计

**登录**

| 序号 | 类型   | 信息内容     | 信息表现 | 说明                               |
| ---- | ------ | ------------ | -------- | ---------------------------------- |
| 1    | 输入框 | 用户名输入框 | 字符提示 | 输入已创建的用户名，显示在登录框中 |
| 2    | 输入框 | 密码输入框   | 字符提示 | 输入对应密码，显示在登录框中       |
| 3    | 按钮   | 登录         | 按钮提示 | 点击后可进入系统，显示在登录框中   |

**登出**

| 序号 | 类型 | 信息内容 | 信息表现 | 说明                           |
| ---- | ---- | -------- | -------- | ------------------------------ |
| 1    | 按钮 | 退出登录 | 按钮提示 | 点击后可退出系统，显示在顶栏中 |

#### 3.1.4 相关接口

| 序号 | 类型 | 接口名称               | 来源/文档编号 | 说明       |
| ---- | ---- | ---------------------- | ------------- | ---------- |
| 1    | 内部 | /api/admin/auth/login  |               | 管理员登录 |
| 2    | 内部 | /api/admin/auth/logout |               | 管理员登出 |

#### 3.1.5 异常处理

**登录**

| 序号 | 错误编码 | 错误信息         | 说明/处理办法                                              |
| ---- | -------- | ---------------- | ---------------------------------------------------------- |
| 1    | A1-E01   | 未输入用户名     | 用户名输入框失去焦点后无输入信息，提示输入用户名           |
| 2    | A1-E02   | 未输入密码       | 用户名输入框失去焦点后无输入信息，提示输入密码             |
| 3    | A1-E03   | 缺少输入项       | 点击登录后检测到未输入用户名或密码，提示输入必要表单项     |
| 4    | A1-E04   | 用户名或密码错误 | 点击登录后检测到用户名或密码密码错误，提示用户名或密码错误 |

**登出**

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                        |
| ---- | -------- | -------- | -------------------------------------------------------------------- |
| 1    | A1-E05   | 登录失效 | 点击退出登录后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 3.2 功能 A2 实现

#### 3.2.1 功能简述

该功能具有基本的管理员账户的创建和删除功能，仅超级管理员拥有该功能权限。仅需填写被创建用户的用户名再点击确认按钮即可完成管理员账号创建，初始密码为系统默认密码。点击需要删除的管理员账户信息后面的删除按钮，并再次确认后即可删除。

#### 3.2.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\A2.jpg" alt="admin_add" style="zoom:75%;" />
    <br>		<!--换行-->
    图 3.2.2.1 创建管理员流程图	<!--标题-->
    </center>
</div>
<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\admin_delete.jpg" alt="admin_add" style="zoom:75%;" />
    <br>		<!--换行-->
    图 3.2.2.2 删除管理员流程图	<!--标题-->
    </center>
</div>

#### 3.2.3 用户界面设计

**创建管理员**

| 序号 | 类型 | 信息内容     | 信息表现 | 说明                                                  |
| ---- | ---- | ------------ | -------- | ----------------------------------------------------- |
| 1    | 文本 | 用户名输入框 | 字符提示 | 遵守字符及长度限制（6~20 个字符），显示在账户创建框里 |
| 2    | 文本 | 默认密码提示 | 字符提示 | 提示系统默认密码内容，显示在账户创建框里              |

**删除管理员**

| 序号 | 类型 | 信息内容  | 信息表现 | 说明             |
| ---- | ---- | --------- | -------- | ---------------- |
| 1    | 文本 | 确认信息  | 字符提示 | 提示是否确认删除 |
| 2    | 按钮 | 确认/取消 | 按钮提示 | 选择是否确认删除 |

#### 3.2.4 相关接口

| 序号 | 类型 | 接口名称                         | 来源/文档编号 | 说明                                     |
| ---- | ---- | -------------------------------- | ------------- | ---------------------------------------- |
| 1    | 内部 | /api/admin/admin_account         |               | 创建、删除管理员账号，查看、修改个人信息 |
| 2    | 内部 | /api/admin/admin_account/issuper |               | 检测是否为超级管理员                     |

#### 3.2.5 异常处理

| 序号 | 错误编码 | 错误信息       | 说明/处理办法                                                |
| ---- | -------- | -------------- | ------------------------------------------------------------ |
| 1    | A2-E01   | 用户名长度不符 | 用户名小于 6 个字符或大于 20 个字符，提示修改                |
| 2    | A2-E02   | 登录失效       | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 3.3 功能 A3 实现

#### 3.3.1 功能简述

该功能具有基本的管理员密码重置功能，仅超级管理员拥有该功能权限。仅需点击需要重置的管理员账户信息后面的重置密码按钮，并再次确认后即可将相应管理员密码重置为系统默认密码。

#### 3.3.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\password_reset.jpg" alt="password_reset" style="zoom:75%;" />
    <br>		<!--换行-->
    图 3.3.2 重置管理员密码流程图	<!--标题-->
    </center>
</div>

#### 3.3.3 用户界面设计

| 序号 | 类型 | 信息内容  | 信息表现 | 说明                 |
| ---- | ---- | --------- | -------- | -------------------- |
| 1    | 文本 | 确认信息  | 字符提示 | 提示是否确认重置密码 |
| 2    | 按钮 | 确认/取消 | 按钮提示 | 选择是否确认重置密码 |

#### 3.3.4 相关接口

| 序号 | 类型 | 接口名称                                | 来源/文档编号 | 说明                 |
| ---- | ---- | --------------------------------------- | ------------- | -------------------- |
| 1    | 内部 | /api/admin/admin_account/reset_password |               | 重置管理员密码       |
| 2    | 内部 | /api/admin/admin_account/issuper        |               | 检测是否为超级管理员 |

#### 3.3.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | A3-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 3.4 功能 A4 实现

#### 3.4.1 功能简述

（超级）管理员点击用户信息管理中的“管理员”按钮，可查询到所有（超级）管理员的信息，并可根据用户名搜索（超级）管理员信息。（超级）管理员可以根据需求选择每页展示的（超级）管理员数量。

#### 3.4.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\list_admin.jpg" alt="password_reset" style="zoom:75%;" />
    <br>		<!--换行-->
    图 3.4.2 (超级)管理员信息查询流程图	<!--标题-->
    </center>
</div>

#### 3.4.3 用户界面设计

| 序号 | 类型       | 信息内容           | 信息表现 | 说明                             |
| ---- | ---------- | ------------------ | -------- | -------------------------------- |
| 1    | 文本       | 用户名             | 字符     | 展示所有（超级）管理员用户名信息 |
| 2    | 文本       | 管理员类型         | 字符     | 展示所有（超级）管理员类型       |
| 3    | 按钮       | 重置密码           | 按钮     |                                  |
| 4    | 按钮       | 删除               | 按钮     |                                  |
| 5    | 搜索输入框 | 用户名             | 字符     | 根据用户名搜索管理员信息         |
| 6    | 下拉选项框 | 每页用户数量选项框 | 选项     |                                  |

#### 3.4.4 相关接口

| 序号 | 类型 | 接口名称                      | 来源/文档编号 | 说明           |
| ---- | ---- | ----------------------------- | ------------- | -------------- |
| 1    | 内部 | /api/admin/admin_account/list |               | 列出管理员账号 |

#### 3.4.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | A4-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 3.5 功能 A5 实现

#### 3.5.1 功能简述

（超级）管理员点击用户信息管理功能中的“小程序用户”按钮，可查询到所有小程序用户的用户名和 rating，点击历次比赛表现可具体查看每位用户参与的所有比赛及排名。（超级）管理员可以根据需求选择每页显示的用户数量、根据用户名筛选检索用户信息、选择升序或降序排名。

#### 3.5.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\A5_view_user_information.png" alt="A5_view_user_information" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 3.5.2 （超级）管理员查看小程序用户信息流程图	<!--标题-->
    </center>
</div>

#### 3.5.3 用户界面设计

| 序号 | 类型       | 信息内容         | 信息表现 | 说明                                                                 |
| ---- | ---------- | ---------------- | -------- | -------------------------------------------------------------------- |
| 1    | 文本       | 用户名           | 字符     | 小程序用户的用户名，显示在小程序用户信息栏中                         |
| 2    | 文本       | rating           | 字符     | 小程序用户的 rating，显示在小程序用户信息栏中                        |
| 3    | 按钮       | 历次比赛表现     | 按钮     | 点击弹窗展示用户历次比赛表现和答题情况，按钮显示在小程序用户信息栏中 |
| 4    | 搜索输入框 | 用户名关键字     | 字符     | 根据用户名搜索用户信息，显示在小程序用户信息栏顶部                   |
| 5    | 下拉选项框 | 默认、升序、降序 | 选项     | 选择用户排列方式，下拉选项框形式显示在小程序用户信息栏顶部           |
| 6    | 下拉选项框 | 每页用户数量     | 选项     | 选择每页用户数量，下拉选项框形式显示在小程序用户信息栏底部           |

**历次比赛表现**

| 序号 | 类型 | 信息内容      | 信息表现 | 说明                                 |
| ---- | ---- | ------------- | -------- | ------------------------------------ |
| 1    | 文本 | 比赛名称      | 字符     |                                      |
| 2    | 文本 | 是否 rating   | 字符     | 该次比赛成绩是否计入 rating          |
| 3    | 文本 | 比赛得分      | 字符     |                                      |
| 2    | 文本 | 赛前 rating   | 字符     | 用户赛前 rating                      |
| 2    | 文本 | rating 改变量 | 字符     | 以该次比赛情况计算出 rating 的变动值 |

**用户答题情况**

| 序号 | 类型 | 信息内容 | 信息表现 | 说明                 |
| ---- | ---- | -------- | -------- | -------------------- |
| 1    | 文本 | 题目序号 | 字符     |                      |
| 2    | 文本 | 题目 id  | 字符     |                      |
| 3    | 文本 | 是否正确 | 字符     |                      |
| 4    | 文本 | 提交答案 | 字符     | 用户比赛时提交的答案 |
| 5    | 文本 | 正确答案 | 字符     |                      |

#### 3.5.4 相关接口

| 序号 | 类型 | 接口名称                                | 来源/文档编号 | 说明             |
| ---- | ---- | --------------------------------------- | ------------- | ---------------- |
| 1    | 内部 | /api/admin/user_account/list            |               | 列出用户账号     |
| 2    | 内部 | /api/admin/user_account/contest_history |               | 用户历史比赛表现 |
| 3    | 内部 | /api/admin/user_account/contest/result  |               | 用户历史答题情况 |

#### 3.5.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | A5-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 3.6 功能 A6 实现

#### 3.6.1 功能简述

（超级）管理员可在个人中心对自己的个人信息进行修改.

#### 3.6.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\屏幕截图 2022-04-07 111309.png" alt="info_change" style="zoom:75%;" />
    <br>		<!--换行-->
    图 3.6 个人信息修改流程图	<!--标题-->
    </center>
</div>

#### 3.6.3 用户界面设计

**修改个人信息**

| 序号 | 类型   | 信息内容       | 信息表现 | 说明                                                       |
| ---- | ------ | -------------- | -------- | ---------------------------------------------------------- |
| 1    | 文本   | 用户名输入框   | 字符提示 | 遵守字符及长度限制（6~20 个字符），显示在用户名输入框里    |
| 2    | 输入框 | 用户名输入框   | 字符提示 | 输入已创建的用户名，显示在修改框中                         |
| 3    | 文本   | 密码输入框     | 字符提示 | 遵守字符及长度限制（6~20 个字符），显示在密码输入框里      |
| 4    | 输入框 | 密码输入框     | 字符提示 | 输入对应修改密码密码，显示在修改框中                       |
| 5    | 文本   | 电子邮件输入框 | 字符提示 | 遵守字符限制，显示在电子邮件输入框里                       |
| 6    | 输入框 | 电子邮件输入框 | 字符提示 | 输入对应修改联系方式，显示在修改框中                       |
| 7    | 文本   | 电话号码输入框 | 字符提示 | 遵守字符及长度限制（10~12 个字符），显示在电话号码输入框里 |
| 8    | 输入框 | 电话号码输入框 | 字符提示 | 输入对应修改电话号码，显示在修改框中                       |
| 9    | 按钮   | 保存           | 按钮提示 | 点击后可保存修改后的个人信息，显示在弹窗中                 |

#### 3.6.4 相关接口

| 序号 | 类型 | 接口名称                 | 来源/文档编号 | 说明                                     |
| ---- | ---- | ------------------------ | ------------- | ---------------------------------------- |
| 1    | 内部 | /api/admin/admin_account |               | 创建、删除管理员账号，查看、修改个人信息 |

#### 3.6.5 异常处理

| 序号 | 错误编码 | 错误信息       | 说明/处理办法                                                                |
| ---- | -------- | -------------- | ---------------------------------------------------------------------------- |
| 1    | A6-E01   | 输入项为空     | 修改后检测到对应文本框为空，提示输入必要表单项                               |
| 2    | A6-E02   | 登录失效       | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面                 |
| 3    | A6-E03   | 账户权限不足   | 点击保存后检测到对应的个人信息由于权限不足无法修改，提示账户权限不足无法修改 |
| 4    | A6-E04   | 用户名长度不符 | 用户名小于 6 个字符或大于 20 个字符，提示修改                                |
| 4    | A6-E05   | 密码长度不符   | 密码小于 6 个字符或大于 20 个字符，提示修改                                  |

### 3.7 功能 A7 实现

#### 3.7.1 功能简述

用户进行个人信息管理时，可以点击登录按钮进行绑定微信信息；可以修改个人昵称；此外，用户还可以看到个人 RATING 数据

#### 3.7.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\Design_official_3.7.2.png"  style="zoom:60%;"/>
     <br>		<!--换行-->
    图 3.7 小程序个人信息管理流程图	<!--标题-->
    </center>
</div>

#### 3.7.3 用户界面设计

| 序号 | 类型      | 信息内容            | 信息表现  | 说明                                               |
| ---- | --------- | ------------------- | --------- | -------------------------------------------------- |
| 1    | 图片/按钮 | 用户头像/“点击登录” | 图片/按钮 | 点击可出现登录弹窗 （若已登录则无效）              |
| 2    | 按钮      | 下一步可修改昵称    | 字符      | 弹窗输入新昵称                                     |
| 3    | 输入框    | 输入新昵称          | 字符      | 弹窗文本框                                         |
| 4    | 按钮      | 确定新昵称          | 字符      | 弹窗按钮：点击可确定新昵称，然后返回至用户管理页面 |
| 5    | 按钮      | 显示用户 RATING     | 字符      | 点即可获取用户 RATING 然后显示                     |

#### 3.7.4 相关接口

| 序号 | 类型 | 接口名称              | 来源/文档编号 | 说明                   |
| ---- | ---- | --------------------- | ------------- | ---------------------- |
| 1    | 内部 | /api/user/auth/login  |               | 用户登录               |
| 2    | 内部 | /api/user/auth/logout |               | 用户登出               |
| 3    | 内部 | /api/user/profile     |               | 用户查看、修改个人信息 |

#### 3.7.5 异常处理

| 序号 | 错误编码 | 错误信息           | 说明/处理办法                |
| ---- | -------- | ------------------ | ---------------------------- |
| 1    | A7-E01   | 用户登录凭证有误   | 提示登录失效并跳转到上一界面 |
| 2    | A7-E02   | 用户昵称输入不存在 | 提示输入不存在               |
| 3    | A7-E03   | 无法获取排名       |                              |

## 4 题库管理功能(B)

| 子功能名称                         | 子功能代号 | 描述                                                                                 |
| :--------------------------------- | ---------- | ------------------------------------------------------------------------------------ |
| 题目添加功能                       | B1         | （超级）管理员可以单个添加或批量导入题目                                             |
| 题目筛选和查看功能                 | B2         | （超级）管理员可以根据题目的任一或多个属性对题目进行筛选或直接查看当前题库中全部题目 |
| 题目编辑功能                       | B3         | （超级）管理员可以对题目的属性信息进行修改                                           |
| 题目（批量）删除功能               | B4         | （超级）管理员可以单个或批量删除题目                                                 |
| 题目（批量）公开功能               | B5         | （超级）管理员可以单个或批量将题目从非公开改为公开                                   |
| 题目标签库中标签的增加、删除、修改 | B6         | 超级管理员可以在所有需要选定标签的界面对标签库中标签进行增、删、改操作               |

### 4.1 功能 B1 实现

#### 4.1.1 功能简述

该功能具有基本的题目添加功能，超级管理员和管理员均拥有该功能权限。添加题目时需在题库管理界面，点击添加题目按钮，在弹出对话框中选择单个添加（默认）/批量导入。
如选择单个添加，需在下面表单中填写题目类型、题目描述、题目选项、题目答案、从标签库中选定题目标签（tag）并选择是否公开本题，再点击“确定”按钮，即可完成添加。
如选择批量导入，需要从该界面下载 Excel 模板，并将要导入的题目按模板格式进行填写（需保证同一批导入的题目标签一致），并将填写完成的文件拖拽到当前界面/在文件管理器中选择该文件，从标签库中选定本次批量导入的题目对应标签，待上传完成后点击确认，即可批量导入。
系统会为导入的所有题目逐一分配题目编号作为其唯一标识属性。

#### 4.1.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\B1.jpg" style="zoom:75%;"/>
    <br>		<!--换行-->
    图 4.1.2 题目添加流程图	<!--标题-->
    </center>
</div>

#### 4.1.3 用户界面设计

| 序号 | 类型       | 信息内容     | 信息表现 | 说明                               |
| ---- | ---------- | ------------ | -------- | ---------------------------------- |
| 1    | 下拉选项框 | 题目类型     | 字符提示 | 共有单选题、多选项、填空题、判断题 |
| 2    | 输入框     | 题目描述     | 字符提示 |                                    |
| 3    | 输入框     | 题目选项     | 字符提示 |                                    |
| 4    | 输入框     | 题目答案     | 字符提示 |                                    |
| 5    | 标签       | 题目标签     | 字符提示 | 从标签库中选择题目标签             |
| 6    | 选项       | 是否公开     | 选项提示 |                                    |
| 7    | 文件导入框 | 题目文件导入 | 文本提示 | 用于批量导入题目                   |
| 8    | 按钮       | 确认按钮     | 按钮提示 | 确认添加题目                       |
| 9    | 按钮       | 取消按钮     | 按钮提示 | 取消添加题目                       |

#### 4.1.4 相关接口

| 序号 | 类型 | 接口名称                     | 来源/文档编号 | 说明               |
| ---- | ---- | ---------------------------- | ------------- | ------------------ |
| 1    | 内部 | /api/admin/problem           |               | 单个添加题目       |
| 2    | 内部 | /api/admin/problem/batch/add |               | 批量添加题目       |
| 3    | 内部 | /api/general/tag/list        |               | 查看标签库现有标签 |

#### 4.1.5 异常处理

| 序号 | 错误编码 | 错误信息             | 说明/处理办法                                                        |
| ---- | -------- | -------------------- | -------------------------------------------------------------------- |
| 1    | B1-E01   | 缺少输入项           | 点击确认后检测到有未填写的题目信息，提示请完善题目信息               |
| 2    | B1-E02   | 题目描述过长         | 题目描述输入框失去焦点后若超过 20 个字符，则提示题目过长             |
| 3    | B1-E03   | 题目选项过长         | 题目选项输入框失去焦点后若超过 15 个字符，则提示题目过长             |
| 4    | B1-E04   | 批量导入文件格式错误 | 如果文件内容未按模板格式填写，将会导入失败，并提示格式不符的行号信息 |
| 5    | B1-E05   | 登录失效             | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面         |

### 4.2 功能 B2 实现

#### 4.2.1 功能简述

该功能具有基本的题目筛选和查看功能，超级管理员和管理员均拥有该功能权限。可以直接在题库管理界面对当前题库中所有题目信息进行查看。也可根据题目 id、题目类型、题目描述、题目标签、是否公开、作者用户名中任一或多个属性信息对当前题库中的题目进行筛选。

#### 4.2.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\B2.jpg" style="zoom:75%;" />
    <br>		<!--换行-->
    图 4.2.2 题目筛选和查看流程图	<!--标题-->
    </center>
</div>

#### 4.2.3 用户界面设计

| 序号 | 类型       | 信息内容       | 信息表现 | 说明                   |
| ---- | ---------- | -------------- | -------- | ---------------------- |
| 1    | 输入框     | 题目 id        | 字符提示 |                        |
| 2    | 下拉选项框 | 题目类型       | 字符提示 |                        |
| 3    | 输入框     | 题目描述       | 字符提示 |                        |
| 4    | 标签       | 题目标签       | 字符提示 | 从标签库中选择题目标签 |
| 5    | 选项       | 是否公开       | 选项提示 |                        |
| 6    | 输入框     | 题目作者用户名 | 字符提示 |                        |

#### 4.2.4 相关接口

| 序号 | 类型 | 接口名称                              | 来源/文档编号 | 说明               |
| ---- | ---- | ------------------------------------- | ------------- | ------------------ |
| 1    | 内部 | /api/admin/admin_account              |               | 查看题目信息       |
| 2    | 内部 | /api/general/tag/list                 |               | 查看标签库现有标签 |
| 3    | 内部 | /api/admin/admin_account/get_username |               | 查看账号用户名     |

#### 4.2.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | B2-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 4.3 功能 B3 实现

#### 4.3.1 功能简述

该功能具有基本的题目编辑功能，超级管理员有编辑题库中所有题目的权限，管理员仅有编辑自己创建的题目的权限。可以直接在题库管理界面点击相应题目后面的“编辑”按钮，对所选题目的题目类型、题目描述、题目选项、题目答案、题目标签（tag）、是否公开中任一或多个属性信息进行修改 **(因对于公开状态的题目，用户可通过随机组卷的方式在竞赛前获得，为保证公平性，“是否公开”属性仅支持单向的从不公开改为公开状态）**。

#### 4.3.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\B3.jpg" style="zoom:75%;" />
    <br>		<!--换行-->
    图 4.3.2 题目编辑流程图	<!--标题-->
    </center>
</div>

#### 4.3.3 用户界面设计

| 序号 | 类型       | 信息内容 | 信息表现 | 说明                               |
| ---- | ---------- | -------- | -------- | ---------------------------------- |
| 1    | 下拉选项框 | 题目类型 | 字符提示 | 共有单选题、多选项、填空题、判断题 |
| 2    | 输入框     | 题目描述 | 字符提示 |                                    |
| 3    | 输入框     | 题目选项 | 字符提示 |                                    |
| 4    | 输入框     | 题目答案 | 字符提示 |                                    |
| 5    | 标签       | 题目标签 | 字符提示 | 从标签库中选择题目标签             |
| 6    | 选项       | 是否公开 | 选项提示 |                                    |
| 7    | 按钮       | 确认按钮 | 按钮提示 | 确认添加题目                       |
| 8    | 按钮       | 取消按钮 | 按钮提示 | 取消添加题目                       |

#### 4.3.4 相关接口

| 序号 | 类型 | 接口名称                              | 来源/文档编号 | 说明                 |
| ---- | ---- | ------------------------------------- | ------------- | -------------------- |
| 1    | 内部 | /api/admin/problem                    |               | 修改题目信息         |
| 2    | 内部 | /api/general/tag/list                 |               | 查看标签库现有标签   |
| 2    | 内部 | /api/admin/admin_account/issuper      |               | 检测是否为超级管理员 |
| 3    | 内部 | /api/admin/admin_account/get_username |               | 查看账号用户名       |

#### 4.3.5 异常处理

| 序号 | 错误编码 | 错误信息     | 说明/处理办法                                                |
| ---- | -------- | ------------ | ------------------------------------------------------------ |
| 1    | B3-E01   | 题目描述过长 | 题目描述输入框失去焦点后若超过 20 个字符，则提示题目过长     |
| 2    | B3-E02   | 题目选项过长 | 题目选项输入框失去焦点后若超过 15 个字符，则提示题目过长     |
| 3    | B3-E03   | 缺少输入项   | 点击确认后检测到有未填写的题目信息，提示请完善题目信息       |
| 4    | B3-E04   | 登录失效     | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |
| 5    | B3-E05   | 权限不足     | 权限不足，编辑失败                                           |

### 4.4 功能 B4 实现

#### 4.4.1 功能简述

该功能具有基本的题目（批量）删除功能，超级管理员有对题库中所有题目的删除权限，管理员仅有删除自己创建的题目的权限。可以直接在题库管理界面勾选需要删除的题目，并点击“删除”按钮，在确认对话框中再次确认后，即可对相应题目进行删除。

#### 4.4.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\B4.jpg" style="zoom:75%;" />
    <br>		<!--换行-->
    图 4.4.2 题目（批量）删除流程图	<!--标题-->
    </center>
</div>

#### 4.4.3 用户界面设计

| 序号 | 类型 | 信息内容  | 信息表现 | 说明                 |
| ---- | ---- | --------- | -------- | -------------------- |
| 1    | 文本 | 确认信息  | 字符提示 | 提示是否确认删除题目 |
| 2    | 按钮 | 确认/取消 | 按钮提示 | 选择是否确认删除题目 |

#### 4.4.4 相关接口

| 序号 | 类型 | 接口名称                              | 来源/文档编号 | 说明                 |
| ---- | ---- | ------------------------------------- | ------------- | -------------------- |
| 1    | 内部 | /api/admin/problem                    |               | 删除题目             |
| 2    | 内部 | /api/admin/admin_account/issuper      |               | 检测是否为超级管理员 |
| 3    | 内部 | /api/admin/admin_account/get_username |               | 查看账号用户名       |

#### 4.4.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | B4-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |
| 2    | B4-E02   | 权限不足 | 权限不足，删除失败                                           |

### 4.5 功能 B5 实现

#### 4.5.1 功能简述

该功能具有基本的题目（批量）公开功能，超级管理员有对题库中所有题目的公开权限，管理员仅有公开自己创建的题目的权限。可以直接在题库管理界面勾选需要公开的题目，并点击“公开”按钮，在确认对话框中再次确认后，即可对相应题目进行公开**(因对于公开状态的题目，用户可通过随机组卷的方式在竞赛前获得，为保证公平性，“是否公开”属性仅支持单向的从不公开改为公开状态）**。对于选中的原本为公开状态的题目会向用户反馈这些题目的 id 进行提示，不会进行状态修改。

#### 4.5.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\B5.jpg" style="zoom:75%;" />
    <br>		<!--换行-->
    图 4.5.2 题目（批量）公开流程图	<!--标题-->
    </center>
</div>

#### 4.5.3 用户界面设计

| 序号 | 类型 | 信息内容  | 信息表现 | 说明                 |
| ---- | ---- | --------- | -------- | -------------------- |
| 1    | 文本 | 确认信息  | 字符提示 | 提示是否确认公开题目 |
| 2    | 按钮 | 确认/取消 | 按钮提示 | 选择是否确认公开题目 |

#### 4.5.4 相关接口

| 序号 | 类型 | 接口名称                              | 来源/文档编号 | 说明                 |
| ---- | ---- | ------------------------------------- | ------------- | -------------------- |
| 1    | 内部 | /api/admin/problem/batch/public       |               | 批量公开题目         |
| 2    | 内部 | /api/admin/admin_account/issuper      |               | 检测是否为超级管理员 |
| 3    | 内部 | /api/admin/admin_account/get_username |               | 查看账号用户名       |

#### 4.5.5 异常处理

| 序号 | 错误编码 | 错误信息   | 说明/处理办法                                                                |
| ---- | -------- | ---------- | ---------------------------------------------------------------------------- |
| 1    | B5-E01   | 登录失效   | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面                 |
| 2    | B5-E02   | 题目已公开 | 对于已公开的题目，如再次勾选并点击“公开”，将会给出提示，不会改变题目公开状态 |
| 3    | B5-E03   | 权限不足   | 权限不足，公开失败                                                           |

### 4.6 功能 B6 实现

#### 4.6.1 功能简述

该功能具有对于题目标签库中标签的增加、删除、修改功能，仅超级管理员有该权限。超级管理员可在任一需要从标签库中选定标签的界面对标签库中标签进行增、删、改操作。

#### 4.6.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\B6.jpg" style="zoom:75%;" />
    <br>		<!--换行-->
    图 4.6.2 题目标签库中标签的增加、删除、修改流程图	<!--标题-->
    </center>
</div>

#### 4.6.3 用户界面设计

| 序号 | 类型 | 信息内容 | 信息表现 | 说明 |
| ---- | ---- | -------- | -------- | ---- |
| 1    | 按钮 | 增加标签 | 字符提示 |      |
| 2    | 按钮 | 编辑标签 | 字符提示 |      |
| 3    | 按钮 | 删除标签 | 字符提示 |      |

#### 4.6.4 相关接口

| 序号 | 类型 | 接口名称                         | 来源/文档编号 | 说明                 |
| ---- | ---- | -------------------------------- | ------------- | -------------------- |
| 1    | 内部 | /api/admin/admin_account/issuper |               | 检测是否为超级管理员 |
| 2    | 内部 | /api/admin/tag                   |               | 增删改标签           |

#### 4.6.5 异常处理

| 序号 | 错误编码 | 错误信息     | 说明/处理办法                                                  |
| ---- | -------- | ------------ | -------------------------------------------------------------- |
| 1    | B6-E01   | 登录失效     | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面   |
| 2    | B6-E02   | 标签内容为空 | 修改状态中，如失去焦点时标签内容为空则取消修改，恢复原标签内容 |

## 5 自主组卷练习功能(C)

| 子功能名称             | 子功能代号 | 描述                                   |
| :--------------------- | ---------- | -------------------------------------- |
| 自主组卷用户答题功能   | C1         | 用户可在答题页面进行答题               |
| 自主组卷系统组卷功能   | C2         | 用户选择题目标签和数量后由系统组卷     |
| 自组卷系统答题结果回顾 | C3         | 用户可在当次组卷答题后查看本次答题结果 |

### 5.1 功能 C1 实现

#### 5.1.1 功能简述

用户通过自主练习页面进入答题页面后，显示题目类型并可根据题目内容进行答题。用户可点击选项按钮，然后点击提交按钮，随后界面可显示答案是否正确。用户亦可点击下一题按钮查看下一题。

#### 5.1.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\Design_official_5.1.2.png" style="zoom:60%;"/>
        <br>		<!--换行-->
    图 5.1 小程序自主组卷用户答题流程图	<!--标题-->
    </center>
</div>

#### 5.1.3 用户界面设计

| 序号 | 类型   | 信息内容  | 信息表现 | 说明                                     |
| ---- | ------ | --------- | -------- | ---------------------------------------- |
| 1    | 输入框 | 比赛名称  | 字符     | 显示目前题目类型                         |
| 2    | 文本   | 题干      | 字符     | 显示目前题目主体                         |
| 3    | 按钮   | 选项      | 字符     | 点击预确认答案（打勾，再点击可取消打勾） |
| 4    | 输入框 | 填空答案  | 字符     | 填入填空答案                             |
| 5    | 按钮   | 提交答案  | 按钮     | 点击可显示答案是否正确                   |
| 6    | 文本   | 正确/错误 | 字符     | 显示正误                                 |
| 7    | 按钮   | 下一题    | 按钮     | 点击可显示新题目类型、题目主体、题目选项 |

#### 5.1.4 相关接口

| 序号 | 类型 | 接口名称                         | 来源/文档编号 | 说明     |
| ---- | ---- | -------------------------------- | ------------- | -------- |
| 1    | 内部 | /api/user/exercise/problem       |               | 获取题面 |
| 2    | 内部 | /api/user/exercise/problem/check |               | 验证答案 |

#### 5.1.5 异常处理

### 5.2 功能 C2 实现

#### 5.2.1 功能简述

用户通过自主练习页面进入选择练习内容页面，显示所有题目标签，用户可以选择部分或全部标签，然后选择题目数量。由后端向前端发送试卷所有题号然后按序开始答题，即进入功能**C1**。

#### 5.2.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\design_offical5.2.2.png" alt="A5.2.2" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 5.2.2 自主组卷功能系统组卷流程图	<!--标题-->
    </center>
</div>

#### 5.2.3 用户界面设计

| 序号 | 类型     | 信息内容 | 信息表现 | 说明                 |
| ---- | -------- | -------- | -------- | -------------------- |
| 1    | 文本     | 标签     | 字符     | 显示目前可选题目标签 |
| 2    | 下拉选框 | 选题数量 | 数字     | 显示可选联系题目数量 |

#### 5.2.4 相关接口

| 序号 | 类型 | 接口名称                   | 来源/文档编号 | 说明     |
| ---- | ---- | -------------------------- | ------------- | -------- |
| 1    | 内部 | /api/user/exercise/collect |               | 获取题库 |

#### 5.2.5 异常处理

### 5.2 功能 C3 实现

#### 5.2.1 功能简述

用户在**C2、C1** 完成后进入当次练习回顾页面，由于答题后为该功能唯一入口所以，仅可展示当次练习的答题正确情况，而不会留存历史记录。

#### 5.2.2 功能实现流程

答题时保存在本地缓存，结束后统一展示

#### 5.2.3 用户界面设计

| 序号 | 类型 | 信息内容     | 信息表现 | 说明                         |
| ---- | ---- | ------------ | -------- | ---------------------------- |
| 1    | 文本 | 正确率       | 字符     | 本次练习的正确率             |
| 2    | 按钮 | 题号，正确性 | 数字     | 按钮红绿颜色区分答题正确与否 |

#### 5.2.4 相关接口

完全前端实现，无接口

#### 5.2.5 异常处理

## 6 比赛功能(D)

| 子功能名称           | 子功能代号 | 描述                                                               |
| :------------------- | ---------- | ------------------------------------------------------------------ |
| 比赛用户限时答题功能 | D1         | 用户在答题页面进行答题                                             |
| 创建比赛功能         | D2         | （超级）管理员在比赛管理界面创建比赛                               |
| 查找比赛功能         | D3         | （超级）管理员在比赛管理界面根据比赛名称查找比赛                   |
| 修改、删除比赛功能   | D4         | （超级）管理员在比赛管理界面修改和删除比赛                         |
| 查看比赛分析         | D5         | （超级）管理员可以查看比赛排行榜和结果分析                         |
| 公布结果功能         | D6         | （超级）管理员需在比赛结束后公布比赛结果，以便用户查看个人答题情况 |
| 用户查看比赛简述功能 | D7         | 用户可以在比赛查看页面查看所有比赛及其状态                         |
| 用户比赛回顾功能     | D8         | 用户可以在比赛回顾页面查看比赛信息和排行榜信息                     |

### 6.1 功能 D1 实现

#### 6.1.1 功能简述

进入比赛后, 系统显示题目, 用户要在规定时间内答题, 并提交答案. 提交或超市之后, 系统之后应当显示下一题内容, 以此类推. 所有题目作答/超时完毕应当结束比赛.

#### 6.1.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\Limited_quiz_flowchart.drawio.png" alt="A5.2.2" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 6.1.2 比赛用户限时答题流程图	<!--标题-->
    </center>
</div>

#### 6.1.3 前后端交互方式

在过程中, 为了保证限时的可靠性和数据的相容性, 对于特定的比赛和用户, 服务端需要保存下列信息.

$n_c$ : 当前题目序号, $t_c$ : 当前题目的开始时间.

当用户提交答案时, 系统应当检验 $t-t_c\le dt_{n_c}$ 来决定是否接受, 其中 $dt_i$ 代表第 $i$ 题时限, $t$ 代表服务器时间. 当用户作答或前端认为到达时限后, 应当向后端请求下一题, 后端此时应当返回第 $\min\{k, n_c+1\}$ 题, $s.t.\ (t-t_c)\in [\sum_{i=n_c}^{k-1}dt_i, \sum_{i=n_c}^{k}dt_i)$ , 并告知前端这一题的剩余时间是 $(\sum_{i=n_c}^{k}dt_i)-(t-t_c)$ .

#### 6.1.4 用户界面设计

| 序号 | 类型   | 信息内容 | 信息表现   | 说明                         |
| ---- | ------ | -------- | ---------- | ---------------------------- |
| 1    | 文本框 | 题干内容 | 字符       | 题干内容                     |
| 2    | 按钮   | 选项内容 | 字符，按钮 | 选项内容（在多选或单选题中） |
| 3    | 输入框 | 无       | 无         | 填空题输入框                 |

#### 6.1.5 相关接口

| 序号 | 类型 | 接口名称                         | 来源/文档编号 | 说明     |
| ---- | ---- | -------------------------------- | ------------- | -------- |
| 1    | 内部 | /api/user/contest/problem        |               | 获取题面 |
| 2    | 内部 | /api/user/contest/problem/submit |               | 提交答案 |

#### 6.1.6 异常处理

### 6.2 功能 D2 实现

#### 6.2.1 功能简述

（超级）管理员可以创建比赛，点击创建比赛按钮后出现创建比赛弹窗。（超级）管理员需确定比赛名称，选择比赛开始时间、最晚开始时间、答题时间、是否为私密比赛、是否计入 rating 属性，选定赛题以创建比赛。

#### 6.2.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\D2_ga1.png" alt="D2_ga1" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 6.2.2 创建比赛功能流程图	<!--标题-->
    </center>
</div>

#### 6.2.3 用户界面设计

| 序号 | 类型   | 信息内容         | 信息表现 | 说明                                                                             |
| ---- | ------ | ---------------- | -------- | -------------------------------------------------------------------------------- |
| 1    | 输入框 | 比赛名称         | 字符     | 输入本次比赛名称，必填                                                           |
| 2    | 选项框 | 比赛开始时间     | 时间     | 选择比赛开始时间，必选                                                           |
| 3    | 选项框 | 比赛最晚开始时间 | 时间     | 选择比赛最晚开始时间。用户需要在比赛开始时间与比赛最晚开始时间之间开始答题，必选 |
| 4    | 选项框 | 单选题时间限制   | 选项     | 需要在规定时间内完成单选题，必选                                                 |
| 5    | 选项框 | 多选题时间限制   | 选项     | 需要在规定时间内完成多选题，必选                                                 |
| 6    | 选项框 | 判断题时间限制   | 选项     | 需要在规定时间内完成判断题，必选                                                 |
| 7    | 选项框 | 填空题时间限制   | 选项     | 需要在规定时间内完成填空题，必选                                                 |
| 8    | 单选框 | 是否为公开赛     | 选项     | 必选                                                                             |
| 9    | 输入框 | 比赛密码         | 字符     | 若非公开赛需设置参赛密码，用户输入正确的参赛密码即可参加比赛                     |
| 10   | 单选框 | 是否计入 rating  | 选项     | 告知用户该次比赛是否计入 rating，实际操作以赛后设置为准，必选                    |
| 11   | 按钮   | 选择考题         | 按钮     | 点击后翻页进入选择题目界面                                                       |
| 12   | 按钮   | 考试设置         | 按钮     | 点击后翻页返回比赛设置界面                                                       |
| 13   | 选项框 | 题目标签         | 选项     | 根据题目标签筛选题目，显示在选择考题界面                                         |
| 14   | 输入框 | 题目编号         | 字符     | 根据题目编号筛选题目，显示在选择考题界面                                         |
| 15   | 输入框 | 题目描述         | 字符     | 根据题目描述筛选题目，显示在选择考题界面                                         |
| 16   | 选项框 | 题目是否为公开赛 | 选项     | 根据题目是否为公开筛选题目，显示在选择考题界面                                   |
| 17   | 选项框 | 题目类型         | 选项     | 根据题目类型筛选题目，显示在选择考题界面                                         |
| 18   | 输入框 | 题目作者用户名   | 字符     | 根据题目作者用户名筛选题目，显示在选择考题界面                                   |
| 19   | 文本   | 显示所有题目     | 字符     | 展示题目筛选结果，供（超级）管理员勾选加入比赛，必选                             |
| 20   | 单选   | 是否有序勾选     | 选项     | 若选择有序勾选则赛题顺序为勾选顺序，否则为题目编号顺序                           |
| 21   | 按钮   | 加入比赛         | 按钮     | 将勾选题目加入比赛，最多将 30 个题目加入比赛                                     |
| 22   | 按钮   | 创建比赛         | 按钮     | 点击后根据 1-21 的设置创建比赛                                                   |

#### 6.2.4 相关接口

| 序号 | 类型 | 接口名称           | 来源/文档编号 | 说明                   |
| ---- | ---- | ------------------ | ------------- | ---------------------- |
| 1    | 内部 | /api/admin/contest |               | （超级）管理员创建比赛 |

#### 6.2.5 异常处理

| 序号 | 错误编码 | 错误信息             | 说明/处理办法                                                    |
| ---- | -------- | -------------------- | ---------------------------------------------------------------- |
| 1    | D2-E01   | 未输入比赛名称       | 比赛名称输入框失去焦点后无信息输入，提示输入比赛名称             |
| 2    | D2-E02   | 未输入比赛密码       | 设置密码时，比赛密码输入框失去焦点后无信息输入，提示输入比赛密码 |
| 3    | D2-E03   | 未设置比赛时间       | 设置时间时，若时间选项框失去焦点后无信息输入，提示选择比赛时间   |
| 4    | D2-E04   | 比赛密码长度不符     | 比赛密码长度小于 6 或大于 20，提示修改                           |
| 5    | D2-E05   | 未勾选比赛题目       | 点击“加入比赛”按钮时未有勾选题目，提示勾选题目                   |
| 6    | D2-E06   | 题目数量超过最大限制 | 点击加入比赛时超过最大题数限制，提示修改                         |
| 7    | D2-E07   | 有未设置的比赛属性   | 点击创建比赛按钮后检测到有未设置的比赛属性，提示完善设置         |
| 8    | D2-E08   | 登录失效             | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面     |

### 6.3 功能 D3 实现

#### 6.3.1 功能简述

（超级）管理员可以在比赛管理功能处根据比赛名称检索比赛信息。

#### 6.3.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\D3_info1.png" alt="D3_info1" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 6.3.2 查找比赛功能流程图	<!--标题-->
    </center>
</div>

#### 6.3.3 用户界面设计

| 序号 | 类型       | 信息内容       | 信息表现 | 说明                                           |
| ---- | ---------- | -------------- | -------- | ---------------------------------------------- |
| 1    | 搜索输入框 | 比赛名称关键字 | 字符     | 根据比赛名称搜索比赛信息，显示在比赛信息栏顶部 |

#### 6.3.4 相关接口

| 序号 | 类型 | 接口名称                              | 来源/文档编号 | 说明           |
| ---- | ---- | ------------------------------------- | ------------- | -------------- |
| 1    | 内部 | /api/admin/contest                    |               | 查找比赛       |
| 2    | 内部 | /api/admin/admin_account/get_username |               | 查看账号用户名 |

#### 6.3.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | D3-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 6.4 功能 D4 实现

#### 6.4.1 功能简述

（超级）管理员可以在比赛开始之前修改、删除比赛，也可在任何时刻查看比赛信息，包括创建比赛时的所有设置。

#### 6.4.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\D4_modify1.png" alt="D4_modify1" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 6.4.2 修改、删除比赛功能流程图	<!--标题-->
    </center>
</div>

#### 6.4.3 用户界面设计

| 序号 | 类型       | 信息内容     | 信息表现 | 说明                                                 |
| ---- | ---------- | ------------ | -------- | ---------------------------------------------------- |
| 1    | 文本       | 比赛名称     | 字符     | 显示该次比赛名称                                     |
| 2    | 按钮       | 编辑         | 字符     | 查看、修改比赛信息，显示在比赛名称之后               |
| 3    | 按钮       | 删除         | 字符     | 删除比赛，显示在比赛名称之后                         |
| 4    | 弹窗       | 比赛信息     | 弹窗     | 与创建比赛时的界面一致                               |
| 5    | 下拉选项框 | 每页比赛数量 | 选项     | 选择每页比赛数量，下拉选项框形式显示在比赛信息栏底部 |

#### 6.4.4 相关接口

| 序号 | 类型 | 接口名称                              | 来源/文档编号 | 说明                 |
| ---- | ---- | ------------------------------------- | ------------- | -------------------- |
| 1    | 内部 | /api/admin/contest                    |               | 修改、删除比赛       |
| 2    | 内部 | /api/admin/admin_account/issuper      |               | 检测是否为超级管理员 |
| 3    | 内部 | /api/admin/admin_account/get_username |               | 查看账号用户名       |

#### 6.4.5 异常处理

| 序号 | 错误编码 | 错误信息       | 说明/处理办法                                                                                  |
| ---- | -------- | -------------- | ---------------------------------------------------------------------------------------------- |
| 1    | D4-E01   | 修改不符合约束 | 同创建比赛异常处理 1-6                                                                         |
| 2    | D4-E02   | 无权限         | 管理员仅能修改自己创建的比赛的信息，超级管理员可以修改所有比赛的信息，对超越权限的操作提示警告 |
| 3    | D4-E03   | 无权限         | 管理员仅能删除自己创建的比赛，超级管理员可以删除所有比赛，对超越权限的操作提示警告             |
| 4    | D4-E04   | 登录失效       | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面                                   |

### 6.5 功能 D5 实现

#### 6.5.1 功能简述

在比赛信息列表点击对应比赛的比赛分析按钮可以查看比赛的排名情况和用户答题统计分析，包括用户答题正确率分布直方图，题目正确率分布，参赛情况。

#### 6.5.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\D5_after_game1.png" alt="D5_after_game1" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 6.5.2 查看赛后信息功能流程图	<!--标题-->
    </center>
</div>

#### 6.5.3 用户界面设计

| 序号 | 类型 | 信息内容 | 信息表现 | 说明                                       |
| ---- | ---- | -------- | -------- | ------------------------------------------ |
| 1    | 按钮 | 赛后分析 | 按钮     | 点击后弹窗显示比赛排行榜和用户答题统计分析 |

**比赛排行榜**

| 序号 | 类型 | 信息内容       | 信息表现 | 说明                                 |
| ---- | ---- | -------------- | -------- | ------------------------------------ |
| 1    | 文本 | 排名           | 字符     | 按序展示比赛排名                     |
| 2    | 文本 | 用户名         | 字符     | 参赛用户的用户名                     |
| 3    | 文本 | 得分           | 字符     | 用户在该次比赛中的得分               |
| 4    | 文本 | 用时           | 字符     | 用户比赛总用时                       |
| 5    | 文本 | 回答正确总题数 | 字符     | 比赛过程中查询显示用户当前答对的题数 |
| 6    | 文本 | 赛前 rating    | 字符     | 用户参赛前的 rating                  |
| 7    | 文本 | rating 改变量  | 字符     | 以该次比赛情况计算出 rating 的变动值 |

**用户答题统计分析**

| 序号 | 类型   | 信息内容     | 信息表现 | 说明                                                   |
| ---- | ------ | ------------ | -------- | ------------------------------------------------------ |
| 1    | 统计图 | 用户得分情况 | 直方图   | 分数区间为横坐标，对应分数段的人数为纵坐标             |
| 2    | 统计图 | 各题目正确率 | 直方图   | 题号为横坐标，正确率为纵坐标                           |
| 3    | 统计图 | 用户参赛情况 | 饼状图   | 报名比赛人数为整体，展示实际参赛人数和未参赛人数的比例 |

#### 6.5.4 相关接口

| 序号 | 类型 | 接口名称                       | 来源/文档编号 | 说明           |
| ---- | ---- | ------------------------------ | ------------- | -------------- |
| 1    | 内部 | /api/admin/contest/leaderboard |               | 查看比赛排行榜 |
| 2    | 内部 | /api/admin/contest/statistics  |               | 查看比赛统计   |

#### 6.5.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | D5-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 6.6 功能 D6 实现

#### 6.6.1 功能简述

（超级）管理员在赛后需点击比赛信息后的“公布结果”按钮，以便用户查看个人答题情况，点击后，弹窗提示是否将本次比赛排名计入 rating，可以综合赛前设置和比赛情况选择，确认后用户可查看该次比赛的个人答题情况。一般情况下，赛后是否计入 rating 与赛前设置保持一致，若出现如出题事故等情况可酌情调整。

#### 6.6.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\D6_rating1.png" alt="D6_rating1" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 6.6.2 更新 rating 功能流程图	<!--标题-->
    </center>
</div>

#### 6.6.3 用户界面设计

| 序号 | 类型 | 信息内容     | 信息表现 | 说明 |
| ---- | ---- | ------------ | -------- | ---- |
| 1    | 按钮 | 公布比赛结果 | 字符     |      |

#### 6.6.4 相关接口

| 序号 | 类型 | 接口名称                              | 来源/文档编号 | 说明                 |
| ---- | ---- | ------------------------------------- | ------------- | -------------------- |
| 1    | 内部 | /api/admin/contest/calculate          |               | 公布比赛结果         |
| 2    | 内部 | /api/admin/admin_account/issuper      |               | 检测是否为超级管理员 |
| 3    | 内部 | /api/admin/admin_account/get_username |               | 查看账号用户名       |

#### 6.6.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                                                |
| ---- | -------- | -------- | -------------------------------------------------------------------------------------------- |
| 1    | D6-E01   | 无权限   | 管理员仅能公布自己创建的比赛的结果，超级管理员可以公布所有比赛结果，对超越权限的操作提示警告 |
| 2    | D6-E02   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面                                 |

### 6.7 功能 D7 实现

#### 6.7.1 功能简述

在用户比赛界面展示所有比赛简述条目，条目内容包括用户的参赛情况，比赛的状态（进行中，未开始，已结束）。并提供相应的 **D1** 比赛答题（进行中的比赛）或 **D8** 比赛回顾（已结束且以参赛的比赛）入口。

#### 6.7.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\D7.png" alt="D7" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 6.7 用户查看比赛概述功能流程图	<!--标题-->
    </center>
</div>

#### 6.7.3 用户界面设计

| 序号 | 类型 | 信息内容                         | 信息表现 | 说明                                           |
| ---- | ---- | -------------------------------- | -------- | ---------------------------------------------- |
| 1    | 文字 | 比赛信息概述：参赛情况、比赛状态 | 文本框   |                                                |
| 2    | 按钮 | 比赛答题或比赛回顾               | 按钮     | 根据比赛的属性提供相应按钮，规则在简述中已提供 |

#### 6.7.4 相关接口

| 序号 | 类型 | 接口名称                      | 来源/文档编号 | 说明           |
| ---- | ---- | ----------------------------- | ------------- | -------------- |
| 1    | 内部 | /api/user/contest/records     |               | 查询所有比赛   |
| 2    | 内部 | /api/user/contest/start       |               | 开始比赛       |
| 3    | 内部 | /api/user/contest/record      |               | 查询答题记录   |
| 4    | 内部 | /api/user/contest/leaderboard |               | 查看比赛排行榜 |

#### 6.7.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | D7-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 6.8 功能 D8 实现

#### 6.8.1 功能简述

用户可以比赛回顾页面查看本次比赛信息：题目信息、本次得分、本次耗时、本次排名、本次分数；排行榜信息：本次前三名与用户的 ID、得分、耗时、赛前 rating 和 rating 改变量.。用户可以点击题目按钮进入展示页面。

#### 6.8.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\real_Design_official_6.8.2.png" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 6.8 用户查看比赛回顾流程图	<!--标题-->
    </center>
</div>

#### 6.8.3 用户界面设计

| 序号 | 类型 | 信息内容                                                                  | 信息表现 | 说明                                     |
| ---- | ---- | ------------------------------------------------------------------------- | -------- | ---------------------------------------- |
| 1    | 文字 | 本次比赛信息：得分、耗时、排名、分数                                      | 文本框   |                                          |
| 2    | 文字 | 排行榜前三名与用户信息：排名、ID、得分、耗时、总 rating、总 rating_change | 文本框   |                                          |
| 3    | 按钮 | 本次比赛题目题号                                                          | 按钮     | 根据按钮颜色昭示正误，点击按钮可进入答题 |

#### 6.8.4 相关接口

| 序号 | 类型 | 接口名称                      | 来源/文档编号 | 说明           |
| ---- | ---- | ----------------------------- | ------------- | -------------- |
| 1    | 内部 | /api/user/contest/result      |               | 查询比赛记录   |
| 2    | 内部 | /api/user/contest/leaderboard |               | 查询比赛排行榜 |

#### 6.8.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | D7-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

## 7 接口设计

接口定义请与后端讨论确定, 接口定义表格见`API.md`.

### 7.1 接口 1 定义(这些不着急写, 可以等 API 写完在这放一个精简版)

## 8 数据模型设计

### 8.1 逻辑类图

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\ClassDiagram.png" alt="D4_rating" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 8.1 项目逻辑类图	<!--标题-->
    </center>
</div>
### 8.2 数据模型定义

## 9 参考文献

[1] OmniSci 团队，《设计报告》，北航计算机学院，2019.06.09.
