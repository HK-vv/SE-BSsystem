[TOC]

# BrainStorm 知识竞赛系统设计文档

## 1 版本历史

| 日期     | 版本  | 人员   | 更新内容                                        |
| -------- | ----- | ------ | ----------------------------------------------- |
| 22.03.26 | v0.0  | 赵子涵 | 创建文档及目录; 编写文档介绍.                   |
| 22.03.28 | v0.1  | 李昀泽 | 编辑功能 A 目录                                 |
| 22.03.28 | v0.2  | 刘硕   | 编写 A1 功能，修改功能 A 目录                   |
| 22.03.28 | v0.3  | 李昀泽 | 编写 A2、A3、A4 功能                            |
| 22.03.28 | v0.4  | 刘硕   | 编写 A5 功能，修改 A1 功能                      |
| 22.03.29 | v0.5  | 黄辰麟 | 编写 A7 功能，编写 A8 功能                      |
| 22.03.30 | v0.6  | 张瑞轩 | 编写接口设计相关内容                            |
| 22.03.30 | v0.7  | 赵子涵 | 修改接口路由结构                                |
| 22.03.30 | v0.8  | 黄辰麟 | 编写 C1 功能，修改 A7 A8 功能                   |
| 22.04.01 | v0.9  | 李昀泽 | 修改 A2 功能                                    |
| 22.04.01 | v0.10 | 李昀泽 | 编写功能 B 目录                                 |
| 22.04.04 | v0.11 | 刘硕   | 修改 A 管理端功能异常处理，编写 D2, D3, D4 功能 |

## 2 文档介绍

### 2.1 文档目的

本文档是由 BrainStorm 团队编写, 为 BrainStorm 知识竞赛系统编写的设计文档. 服务于使用和开发本系统的各种人群, 和执行评审的软工课程组.

文档对逻辑分类的各个功能具体描述了界面设计, 接口设计和主要的数据库设计.

望本文能带领读者了解系统的设计细节, 给开发人员提供明确的指导.

### 2.2 术语解释

| 缩写 | 解释                    |
| ---- | ----------------------- |
| BS   | BrainStorm 知识竞赛系统 |
|      |                         |
|      |                         |

### 2.3 参考文献

[1] OmniSci 团队，《设计报告》，北航计算机学院，2019.06.09.

## 3 用户信息管理功能(A)

| 子功能名称                     | 子功能代号 | 描述                                                                                                                     |
| ------------------------------ | ---------- | ------------------------------------------------------------------------------------------------------------------------ |
| 管理员账号登录功能             | A1         | （超级）管理员填写账号密码进行登录。                                                                                     |
| 创建、删除管理员账号功能       | A2         | 由超级管理员创建管理员账号并设定初始密码，管理员可自行修改个人密码。超级管理员可以删除管理员账号，但不能删除自己的账号。 |
| 重置管理员密码功能             | A3         | 超级管理员可将管理员密码重置为默认密码                                                                                   |
| （超级）管理员信息查询功能     | A4         | （超级）管理员可直接浏览系统中所有管理员的信息，并可按（超级）管理员用户名进行查询                                       |
| 微信小程序用户信息查询功能     | A5         | （超级）管理员可直接浏览所有小程序用户的信息，并支持根据用户名进行筛选                                                   |
| （超级）管理员个人信息修改功能 | A6         | （超级）管理员可在个人中心对个人信息进行修改                                                                             |
| 小程序用户端登入登出           | A7         | 用户绑定微信进行登入登出                                                                                                 |
| 小程序用户端修改个人信息       | A8         | 用户修改个人信息                                                                                                         |

### 3.1 功能 A1 实现

#### 3.1.1 功能简述

管理端支持（超级）管理员登录和登出功能。登录时需验证用户名和密码，前端对是否输入信息进行验证，如输入框失去焦点后无信息存留，则提示输入信息。如输入的用户名和密码信息正确则进入系统，否则给出错误信息提示。登出时，点击系统顶栏“退出登录”按钮，系统提示登录失效/已退出账号，并跳转到登录界面。

#### 3.1.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\A1_login.png" alt="login" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 3.1.2 （超级）管理员登录（左）和登出（右）流程图	<!--标题-->
    </center>
</div>

#### 3.1.3 用户界面设计

**登录**

| 序号 | 类型   | 信息内容     | 信息表现 | 说明                               |
| ---- | ------ | ------------ | -------- | ---------------------------------- |
| 1    | 输入框 | 用户名输入框 | 字符提示 | 输入已创建的用户名，显示在登录框中 |
| 2    | 输入框 | 密码输入框   | 字符提示 | 输入对应密码，显示在登录框中       |
| 3    | 按钮   | 登录         | 按钮提示 | 点击后可进入系统，显示在登录框中   |

**登出**

| 序号 | 类型 | 信息内容 | 信息表现 | 说明                           |
| ---- | ---- | -------- | -------- | ------------------------------ |
| 1    | 按钮 | 退出登录 | 按钮提示 | 点击后可退出系统，显示在顶栏中 |

#### 3.1.4 相关接口

| 序号 | 类型 | 接口名称               | 来源/文档编号 | 说明       |
| ---- | ---- | ---------------------- | ------------- | ---------- |
| 1    | 内部 | /api/admin/auth/login  |               | 管理员登录 |
| 2    | 内部 | /api/admin/auth/logout |               | 管理员登出 |

#### 3.1.5 异常处理

**登录**

| 序号 | 错误编码 | 错误信息         | 说明/处理办法                                              |
| ---- | -------- | ---------------- | ---------------------------------------------------------- |
| 1    | A1-E01   | 未输入用户名     | 用户名输入框失去焦点后无输入信息，提示输入用户名           |
| 2    | A1-E02   | 未输入密码       | 用户名输入框失去焦点后无输入信息，提示输入密码             |
| 3    | A1-E03   | 缺少输入项       | 点击登录后检测到未输入用户名或密码，提示输入必要表单项     |
| 4    | A1-E04   | 用户名或密码错误 | 点击登录后检测到用户名或密码密码错误，提示用户名或密码错误 |

**登出**

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                        |
| ---- | -------- | -------- | -------------------------------------------------------------------- |
| 1    | A1-E05   | 登录失效 | 点击退出登录后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 3.2 功能 A2 实现

#### 3.2.1 功能简述

该功能具有基本的管理员账户的创建和删除功能，仅超级管理员拥有该功能权限。仅需填写被创建用户的用户名再点击确认按钮即可完成管理员账号创建，初始密码为系统默认密码。点击需要删除的管理员账户信息后面的删除按钮，并再次确认后即可删除。

#### 3.2.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\A2.jpg" alt="admin_add" style="zoom:75%;" />
    <br>		<!--换行-->
    图 3.2.2.1 创建管理员流程图	<!--标题-->
    </center>
</div>
<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\admin_delete.jpg" alt="admin_add" style="zoom:75%;" />
    <br>		<!--换行-->
    图 3.2.2.2 删除管理员流程图	<!--标题-->
    </center>
</div>

#### 3.2.3 用户界面设计

**创建管理员**
| 序号 | 类型 | 信息内容 | 信息表现 | 说明 |
| ---- | ---- | --------| ---------| -----|
| 1 | 文本 | 用户名输入框 | 字符提示| 遵守字符及长度限制（6~20 个字符），显示在账户创建框里 |
| 2 | 文本 | 默认密码提示 | 字符提示 | 提示系统默认密码内容，显示在账户创建框里 |

**删除管理员**
| 序号 | 类型 | 信息内容 | 信息表现 | 说明 |
| ---- | ---- | --------| ---------| -----|
| 1 | 文本 | 确认信息 | 字符提示| 提示是否确认删除 |
| 2 | 按钮 | 确认/取消 | 按钮提示 | 选择是否确认删除 |

#### 3.2.4 相关接口

| 序号 | 类型 | 接口名称                 | 来源/文档编号 | 说明                                     |
| ---- | ---- | ------------------------ | ------------- | ---------------------------------------- |
| 1    | 内部 | /api/admin/admin_account |               | 创建、删除管理员账号，查看、修改个人信息 |

#### 3.2.5 异常处理

| 序号 | 错误编码 | 错误信息       | 说明/处理办法                                                |
| ---- | -------- | -------------- | ------------------------------------------------------------ |
| 1    | A2-E01   | 用户名长度不符 | 用户名小于 6 个字符或大于 20 个字符，提示修改                |
| 2    | A2-E02   | 登录失效       | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 3.3 功能 A3 实现

#### 3.3.1 功能简述

该功能具有基本的管理员密码重置功能，仅超级管理员拥有该功能权限。仅需点击需要重置的管理员账户信息后面的重置密码按钮，并再次确认后即可将相应管理员密码重置为系统默认密码。

#### 3.3.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\password_reset.jpg" alt="password_reset" style="zoom:75%;" />
    <br>		<!--换行-->
    图 3.3.2 重置管理员密码流程图	<!--标题-->
    </center>
</div>

#### 3.3.3 用户界面设计

| 序号 | 类型 | 信息内容  | 信息表现 | 说明                 |
| ---- | ---- | --------- | -------- | -------------------- |
| 1    | 文本 | 确认信息  | 字符提示 | 提示是否确认重置密码 |
| 2    | 按钮 | 确认/取消 | 按钮提示 | 选择是否确认重置密码 |

#### 3.3.4 相关接口

| 序号 | 类型 | 接口名称                                | 来源/文档编号 | 说明           |
| ---- | ---- | --------------------------------------- | ------------- | -------------- |
| 1    | 内部 | /api/admin/admin_account/reset_password |               | 重置管理员密码 |

#### 3.3.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | A3-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 3.4 功能 A4 实现

#### 3.4.1 功能简述

（超级）管理员点击用户信息管理中的“管理员”按钮，可查询到所有（超级）管理员的信息，并可根据用户名搜索（超级）管理员信息。（超级）管理员可以根据需求选择每页展示的（超级）管理员数量。

#### 3.4.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\list_admin.jpg" alt="password_reset" style="zoom:75%;" />
    <br>		<!--换行-->
    图 3.4.2 (超级)管理员信息查询流程图	<!--标题-->
    </center>
</div>

#### 3.4.3 用户界面设计

| 序号 | 类型       | 信息内容           | 信息表现 | 说明                             |
| ---- | ---------- | ------------------ | -------- | -------------------------------- |
| 1    | 文本       | 用户名             | 字符     | 展示所有（超级）管理员用户名信息 |
| 2    | 文本       | 管理员类型         | 字符     | 展示所有（超级）管理员类型       |
| 3    | 按钮       | 重置密码           | 按钮     |                                  |
| 4    | 按钮       | 删除               | 按钮     |                                  |
| 5    | 搜索输入框 | 用户名             | 字符     | 根据用户名搜索管理员信息         |
| 6    | 下拉选项框 | 每页用户数量选项框 | 选项     |                                  |

#### 3.4.4 相关接口

| 序号 | 类型 | 接口名称                      | 来源/文档编号 | 说明           |
| ---- | ---- | ----------------------------- | ------------- | -------------- |
| 1    | 内部 | /api/admin/admin_account/list |               | 列出管理员账号 |

#### 3.4.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | A4-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 3.5 功能 A5 实现

#### 3.5.1 功能简述

（超级）管理员点击用户信息管理功能中的“小程序用户”按钮，可查询到所有小程序用户的用户名和 rating，点击历次比赛表现可具体查看每位用户参与的所有比赛及排名。（超级）管理员可以根据需求选择每页显示的用户数量、根据用户名筛选检索用户信息、选择升序或降序排名。

#### 3.5.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\A5_view_user_information.png" alt="A5_view_user_information" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 3.5.2 （超级）管理员查看小程序用户信息流程图	<!--标题-->
    </center>
</div>

#### 3.5.3 用户界面设计

| 序号 | 类型       | 信息内容         | 信息表现 | 说明                                                       |
| ---- | ---------- | ---------------- | -------- | ---------------------------------------------------------- |
| 1    | 文本       | 用户名           | 字符     | 小程序用户的用户名，显示在小程序用户信息栏中               |
| 2    | 文本       | rating           | 字符     | 小程序用户的 rating，显示在小程序用户信息栏中              |
| 3    | 按钮       | 历次比赛表现     | 按钮     | 点击弹窗展示用户历次比赛表现，按钮显示在小程序用户信息栏中 |
| 4    | 搜索输入框 | 用户名关键字     | 字符     | 根据用户名搜索用户信息，显示在小程序用户信息栏顶部         |
| 5    | 下拉选项框 | 默认、升序、降序 | 选项     | 选择用户排列方式，下拉选项框形式显示在小程序用户信息栏顶部 |
| 6    | 下拉选项框 | 每页用户数量     | 选项     | 选择每页用户数量，下拉选项框形式显示在小程序用户信息栏底部 |

#### 3.5.4 相关接口

| 序号 | 类型 | 接口名称                                | 来源/文档编号 | 说明             |
| ---- | ---- | --------------------------------------- | ------------- | ---------------- |
| 1    | 内部 | /api/admin/user_account/list            |               | 列出用户账号     |
| 2    | 内部 | /api/admin/user_account/contest_history |               | 用户历史比赛表现 |

#### 3.5.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | A5-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 3.6 功能 A6 实现

#### 3.6.1 功能简述

#### 3.6.2 功能实现流程

#### 3.6.3 用户界面设计

#### 3.6.4 相关接口

| 序号 | 类型 | 接口名称                                | 来源/文档编号 | 说明                                     |
| ---- | ---- | --------------------------------------- | ------------- | ---------------------------------------- |
| 1    | 内部 | /api/admin/admin_account                |               | 创建、删除管理员账号，查看、修改个人信息 |
| 2    | 内部 | /api/admin/admin_account/reset_password |               | 重置管理员密码                           |

#### 3.6.5 异常处理

### 3.7 功能 A7 实现

#### 3.7.1 功能简述 // COMMENT 我们应该没有登出?

当用户在未登录状态时，用户点击菜单主页面登录按钮，弹出是否绑定弹窗，随后可选择绑定微信或返回；当用户在登录状态时，用户点击菜单主页面登录按钮，弹出是否解绑定弹窗，随后可选择解绑微信或返回。

#### 3.7.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\Design_official_3.7.2.png" alt="A5_view_user_information" style="zoom:60%;"/>
    </center>
</div>

#### 3.7.3 用户界面设计

| 序号 | 类型 | 信息内容              | 信息表现 | 说明                                            |
| ---- | ---- | --------------------- | -------- | ----------------------------------------------- |
| 1    | 按钮 | 用户头像/“未登录”     | 按钮     | 点击可出现登录或登出弹窗                        |
| 2    | 文本 | “请问是否登录/登出”   | 图片     | 弹窗提示文字                                    |
| 3    | 按钮 | “微信登陆”/“微信登出” | 按钮     | 弹窗按钮：点击即可登录/登出，随后返回菜单主页面 |
| 4    | 按钮 | “取消”                | 按钮     | 弹窗按钮：点击可关闭弹窗                        |

#### 3.7.4 相关接口

| 序号 | 类型 | 接口名称              | 来源/文档编号 | 说明     |
| ---- | ---- | --------------------- | ------------- | -------- |
| 1    | 内部 | /api/user/auth/login  |               | 用户登录 |
| 2    | 内部 | /api/user/auth/logout |               | 用户登出 |

#### 3.7.5 异常处理

### 3.8 功能 A8 实现

#### 3.8.1 功能简述

当用户在登录状态时，可点击菜单主页面更改信息按钮，弹出改变 ID 弹窗，随后可输入新 ID 或返回，输入新 ID 后点击确认即可改变 ID 并自动返回。

#### 3.8.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\Design_official_3.8.2.png" alt="A5_view_user_information" style="zoom:60%;"/>
    </center>
</div>

#### 3.8.3 用户界面设计

| 序号 | 类型   | 信息内容       | 信息表现 | 说明                                     |
| ---- | ------ | -------------- | -------- | ---------------------------------------- |
| 1    | 按钮   | “修改用户信息” | 按钮     | 点击可出现修改信息弹窗                   |
| 2    | 图片   | 微信头像       | 图片     | 弹窗图片：显示微信头像                   |
| 3    | 文本   | 原用户名       | 字符     | 弹窗文本：原用户名                       |
| 4    | 输入框 | 有限字符       | 字符     | 弹窗输入：可输入新用户名                 |
| 5    | 按钮   | “确认”         | 按钮     | 弹窗按钮：点击即可确认新用户名并关闭弹窗 |
| 6    | 按钮   | “取消”         | 按钮     | 弹窗按钮：点击可关闭弹窗                 |

#### 3.8.4 相关接口

| 序号 | 类型 | 接口名称          | 来源/文档编号 | 说明                   |
| ---- | ---- | ----------------- | ------------- | ---------------------- |
| 1    | 内部 | /api/user/profile |               | 用户查看、修改个人信息 |

#### 3.8.5 异常处理

## 4 题库管理功能(B)(lyz editing)

| 子功能名称           | 子功能代号 | 描述                               |
| :------------------- | ---------- | ---------------------------------- |
| 题库添加功能 | B1         | （超级）管理员可以单个添加或批量导入题目    |
| 题目筛选和查看功能 | B2         | （超级）管理员可以根据题目的任一或多个属性对题目进行筛选或直接查看当前题库中全部题目 |
| 题目编辑功能 |   B3         | （超级）管理员可以对题目的属性信息进行修改 |
| 题目（批量）删除功能 |   B4         | （超级）管理员可以单个或批量删除题目 |
| 题目（批量）公开功能 |   B5         | （超级）管理员可以单个或批量将题目从非公开改为公开 |
| 题目标签库中标签的增加、删除、修改 | B6 | 超级管理员可以在所有需要选定标签的界面对标签库中标签进行增、删、改操作 |
### 4.1 功能 B1 实现

#### 4.1.1 功能简述

该功能具有基本的题库添加功能，超级管理员和管理员均拥有该功能权限。添加题目时需在题库管理界面，点击添加题目按钮，在弹出对话框中选择单个添加（默认）/批量导入。<br/>
如选择单个添加，需在下面表单中填写题目类型、题目描述、题目选项、题目答案、从标签库中选定题目标签（tag）并选择是否公开本题，再点击“确定”按钮，即可完成添加。<br/>
如选择批量导入，需要从该界面下载Excel模板，并将要导入的题目按模板格式进行填写（需保证同一批导入的题目标签一致），并将填写完成的文件拖拽到当前界面/在文件管理器中选择该文件，从标签库中选定本次批量导入的题目对应标签，待上传完成后点击确认，即可批量导入。<br/>
系统会为导入的所有题目逐一分配题目编号作为其唯一标识属性。

#### 4.1.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 4.1.2 （超级）管理员登录（左）和登出（右）流程图	<!--标题-->
    </center>
</div>

#### 4.1.3 用户界面设计

| 序号 | 类型   | 信息内容     | 信息表现 | 说明                               |
| ---- | ------ | ------------ | -------- | ---------------------------------- |
| 1    | 下拉选项框 | 题目类型 | 字符提示 | 共有单选题、多选项、填空题、判断题 |
| 2    | 输入框 | 题目描述 | 字符提示 |  |
| 3    | 输入框 | 题目选项 | 字符提示 |  |
| 4    | 输入框 | 题目答案 | 字符提示 |  |
| 5    | 标签   | 题目标签 | 字符提示 | 从标签库中选择题目标签  |
| 6    | 选项   | 是否公开 | 选项提示 |  |
| 7    | 文件导入框 | 题目文件导入 | 文本提示 | 用于批量导入题目  |
| 8    | 按钮 | 确认按钮 | 按钮提示 | 确认添加题目  |
| 9    | 按钮 | 取消按钮 | 按钮提示 | 取消添加题目  |
#### 4.1.4 相关接口

| 序号 | 类型 | 接口名称               | 来源/文档编号 | 说明       |
| ---- | ---- | ---------------------- | ------------- | ---------- |
| 1    | 内部 |  |               |  |
| 2    | 内部 |  |               |  |

#### 4.1.5 异常处理

| 序号 | 错误编码 | 错误信息         | 说明/处理办法                                                        |
| ---- | -------- | ---------------- | -------------------------------------------------------------------- |
| 1    | B1-E01   | 缺少输入项 | 点击确认后检测到有未填写的题目信息，提示请完善题目信息  |
| 2    | B1-E02   | 题目描述过长 | 题目描述输入框失去焦点后若超过20个字符，则提示题目过长 |
| 3    | B1-E03   | 题目选项过长 | 题目选项输入框失去焦点后若超过15个字符，则提示题目过长 |
| 4    | B1-E04   | 批量导入文件格式错误 | 如果文件内容未按模板格式填写，将会导入失败，并提示格式不符的行号信息   |
| 5    | B1-E05   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 4.2 功能 B2 实现

#### 4.2.1 功能简述

该功能具有基本的题目筛选和查看功能，超级管理员和管理员均拥有该功能权限。可以直接在题库管理界面对当前题库中所有题目信息进行查看。也可根据题目id、题目类型、题目描述、题目标签、是否公开中任一或多个属性信息对当前题库中的题目进行筛选。

#### 4.2.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\" style="zoom:75%;" />
    <br>		<!--换行-->
    图 4.2.2.1 创建管理员流程图	<!--标题-->
    </center>
</div>
<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\" style="zoom:75%;" />
    <br>		<!--换行-->
    图 4.2.2.2 删除管理员流程图	<!--标题-->
    </center>
</div>

#### 4.2.3 用户界面设计

| 序号 | 类型 | 信息内容 | 信息表现 | 说明 |
| ---- | ---- | --------| ---------| -----|
| 1    | 输入框 | 题目id | 字符提示 |  |
| 2    | 下拉选项框 | 题目类型 | 字符提示 |  |
| 3    | 输入框 | 题目描述 | 字符提示 |  |
| 4    | 标签   | 题目标签 | 字符提示 | 从标签库中选择题目标签  |
| 5    | 选项   | 是否公开 | 选项提示 |  |
| 6    | 输入框 | 题目作者用户名 | 字符提示 | |

#### 4.2.4 相关接口

| 序号 | 类型 | 接口名称                 | 来源/文档编号 | 说明                                     |
| ---- | ---- | ------------------------ | ------------- | ---------------------------------------- |
| 1    | 内部 |  |               |  |

#### 4.2.5 异常处理

| 序号 | 错误编码 | 错误信息       | 说明/处理办法                                 |
| ---- | -------- | -------------- | --------------------------------------------- |
| 1    | B2-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 4.3 功能 B3 实现

#### 4.3.1 功能简述

该功能具有基本的题目编辑功能，超级管理员有编辑题库中所有题目的权限，管理员仅有编辑自己创建的题目的权限。可以直接在题库管理界面点击相应题目后面的“编辑”按钮，对所选题目的题目类型、题目描述、题目选项、题目答案、题目标签（tag）、是否公开中任一或多个属性信息进行修改。

#### 4.3.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\" style="zoom:75%;" />
    <br>		<!--换行-->
    图 4.3.2 重置管理员密码流程图	<!--标题-->
    </center>
</div>

#### 4.3.3 用户界面设计

| 序号 | 类型 | 信息内容  | 信息表现 | 说明                 |
| ---- | ---- | --------- | -------- | -------------------- |
| 1    | 下拉选项框 | 题目类型 | 字符提示 | 共有单选题、多选项、填空题、判断题 |
| 2    | 输入框 | 题目描述 | 字符提示 |  |
| 3    | 输入框 | 题目选项 | 字符提示 |  |
| 4    | 输入框 | 题目答案 | 字符提示 |  |
| 5    | 标签   | 题目标签 | 字符提示 | 从标签库中选择题目标签  |
| 6    | 选项   | 是否公开 | 选项提示 |  |
| 7    | 按钮 | 确认按钮 | 按钮提示 | 确认添加题目  |
| 8    | 按钮 | 取消按钮 | 按钮提示 | 取消添加题目  |

#### 4.3.4 相关接口

| 序号 | 类型 | 接口名称                                | 来源/文档编号 | 说明           |
| ---- | ---- | --------------------------------------- | ------------- | -------------- |
| 1    | 内部 |  |               |  |

#### 4.3.5 异常处理

| 序号 | 错误编码 | 错误信息         | 说明/处理办法                                                        |
| ---- | -------- | ---------------- | -------------------------------------------------------------------- |
| 1    | B3-E01   | 题目描述过长 | 题目描述输入框失去焦点后若超过20个字符，则提示题目过长 |
| 2    | B3-E02   | 题目选项过长 | 题目选项输入框失去焦点后若超过15个字符，则提示题目过长 |
| 3    | B3-E03   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 4.4 功能 B4 实现

#### 4.4.1 功能简述

该功能具有基本的题目（批量）删除功能，超级管理员有对题库中所有题目的删除权限，管理员仅有删除自己创建的题目的权限。可以直接在题库管理界面点击相应题目后面的“删除”按钮，并再次确认后，即可对相应题目进行删除。

#### 4.4.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\" style="zoom:75%;" />
    <br>		<!--换行-->
    图 4.4.2 (超级)管理员信息查询流程图	<!--标题-->
    </center>
</div>

#### 4.4.3 用户界面设计

| 序号 | 类型       | 信息内容           | 信息表现 | 说明                             |
| ---- | ---------- | ------------------ | -------- | -------------------------------- |
| 1    | 文本 | 确认信息  | 字符提示 | 提示是否确认删除题目 |
| 2    | 按钮 | 确认/取消 | 按钮提示 | 选择是否确认删除题目 |

#### 4.4.4 相关接口

| 序号 | 类型 | 接口名称                      | 来源/文档编号 | 说明           |
| ---- | ---- | ----------------------------- | ------------- | -------------- |
| 1    | 内部 |  |               |  |

#### 4.4.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | B4-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 4.5 功能 B5 实现

#### 4.5.1 功能简述

该功能具有基本的题目（批量）删除功能，超级管理员有对题库中所有题目的删除权限，管理员仅有删除自己创建的题目的权限。可以直接在题库管理界面点击相应题目后面的“删除”按钮，并再次确认后，即可对相应题目进行删除。

#### 4.5.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\" style="zoom:75%;" />
    <br>		<!--换行-->
    图 4.4.2 (超级)管理员信息查询流程图	<!--标题-->
    </center>
</div>

#### 4.5.3 用户界面设计

| 序号 | 类型       | 信息内容           | 信息表现 | 说明                             |
| ---- | ---------- | ------------------ | -------- | -------------------------------- |
| 1    | 文本 | 确认信息  | 字符提示 | 提示是否确认删除题目 |
| 2    | 按钮 | 确认/取消 | 按钮提示 | 选择是否确认删除题目 |

#### 4.5.4 相关接口

| 序号 | 类型 | 接口名称                      | 来源/文档编号 | 说明           |
| ---- | ---- | ----------------------------- | ------------- | -------------- |
| 1    | 内部 |  |               |  |

#### 4.5.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | B5-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 4.6 功能 B6 实现

#### 4.6.1 功能简述

该功能具有基本的题目（批量）删除功能，超级管理员有对题库中所有题目的删除权限，管理员仅有删除自己创建的题目的权限。可以直接在题库管理界面点击相应题目后面的“删除”按钮，并再次确认后，即可对相应题目进行删除。

#### 4.6.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\" style="zoom:75%;" />
    <br>		<!--换行-->
    图 4.4.2 (超级)管理员信息查询流程图	<!--标题-->
    </center>
</div>

#### 4.6.3 用户界面设计

| 序号 | 类型       | 信息内容           | 信息表现 | 说明                             |
| ---- | ---------- | ------------------ | -------- | -------------------------------- |
| 1    | 文本 | 确认信息  | 字符提示 | 提示是否确认删除题目 |
| 2    | 按钮 | 确认/取消 | 按钮提示 | 选择是否确认删除题目 |

#### 4.6.4 相关接口

| 序号 | 类型 | 接口名称                      | 来源/文档编号 | 说明           |
| ---- | ---- | ----------------------------- | ------------- | -------------- |
| 1    | 内部 |  |               |  |

#### 4.6.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | B6-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

## 5 自主组卷练习功能(C)

| 子功能名称           | 子功能代号 | 描述                               |
| :------------------- | ---------- | ---------------------------------- |
| 自主组卷用户答题功能 | C1         | 用户可在答题页面进行答题           |
| 自主组卷系统组卷功能 | C2         | 用户选择题目标签和数量后由系统组卷 |
|                      |            |                                    |

### 5.1 功能 C1 实现

#### 5.1.1 功能简述

用户通过自主练习页面进入答题页面后，显示题目类型并可根据题目内容进行答题。用户可点击选项按钮，然后点击提交按钮，随后界面可显示答案是否正确。用户亦可点击下一题按钮查看下一题。

#### 5.1.2 功能实现流程 // COMMENT: 包含填空操作

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\Design_official_5.1.2.png" alt="A5_view_user_information" style="zoom:60%;"/>
    </center>
</div>

#### 5.1.3 用户界面设计

| 序号 | 类型   | 信息内容  | 信息表现 | 说明                                     |
| ---- | ------ | --------- | -------- | ---------------------------------------- |
| 1    | 输入框 | 比赛名称  | 字符     | 显示目前题目类型                         |
| 2    | 文本   | 题干      | 字符     | 显示目前题目主体                         |
| 3    | 按钮   | 选项      | 字符     | 点击预确认答案（打勾，再点击可取消打勾） |
| 4    | 按钮   | 提交答案  | 按钮     | 点击可显示答案是否正确                   |
| 5    | 文本   | 正确/错误 | 字符     | 显示正误                                 |
| 6    | 按钮   | 下一题    | 按钮     | 点击可显示新题目类型、题目主体、题目选项 |

#### 5.1.4 相关接口

| 序号 | 类型 | 接口名称                         | 来源/文档编号 | 说明     |
| ---- | ---- | -------------------------------- | ------------- | -------- |
| 1    | 内部 | /api/user/exercise/problem       |               | 获取题面 |
| 2    | 内部 | /api/user/exercise/problem/check |               | 验证答案 |

#### 5.1.5 异常处理

### 5.2 功能 C2 实现

#### 5.2.1 功能简述

用户通过自主练习页面进入选择练习内容页面，显示所有题目标签，用户可以选择部分或全部标签，然后选择题目数量。由后端向前端发送试卷所有题号然后按序开始答题，即进入功能**C1**。

#### 5.2.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\design_offical5.2.2.png" alt="A5.2.2" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 5.2.2 自主组卷功能系统组卷流程图	<!--标题-->
    </center>
</div>

#### 5.2.3 用户界面设计

| 序号 | 类型     | 信息内容 | 信息表现 | 说明                 |
| ---- | -------- | -------- | -------- | -------------------- |
| 1    | 文本     | 标签     | 字符     | 显示目前可选题目标签 |
| 2    | 下拉选框 | 选题数量 | 数字     | 显示可选联系题目数量 |

#### 5.2.4 相关接口

| 序号 | 类型 | 接口名称                   | 来源/文档编号 | 说明     |
| ---- | ---- | -------------------------- | ------------- | -------- |
| 1    | 内部 | /api/user/exercise/collect |               | 获取题库 |

#### 5.2.5 异常处理

## 6 比赛功能(D)

| 子功能名称                 | 子功能代号 | 描述                                                   |
| :------------------------- | ---------- | ------------------------------------------------------ |
| 比赛用户限时答题功能       | D1         | 用户在答题页面进行答题                                 |
| 创建比赛功能               | D2         | （超级）管理员在比赛管理界面创建比赛                   |
| 查看比赛排名与结果分析功能 | D3         | （超级）管理员可以在比赛结束后查看比赛排行榜和结果分析 |
| 更新 rating 功能           | D4         | （超级）管理员可以在比赛结束后选择手动更新 rating      |

### 6.1 功能 D1 实现 (zzh working)

#### 6.1.1 功能简述

进入比赛后, 系统显示题目, 用户要在规定时间内答题, 并提交答案, 系统之后应当显示下一题内容, 以此类推.

在此过程中, 为了保证限时的可靠性和数据的相容性, 对于特定的比赛和用户, 需要保存下列信息.

$n_c$ : 当前题目序号, $t_c$ : 当前题目的开始时间.

当用户提交答案时, 系统应当检验 $t-t_c\le dt_{n_c}$ 来决定是否接受, 其中 $dt_i$ 代表第 $i$ 题时限, $t$ 代表服务器时间. 当用户作答或前端认为到达时限后, 应当向后端请求下一题, 后端此时应当返回第 $\min\{k, n_c+1\}$ 题, $s.t.\ (t-t_c)\in [\sum_{i=n_c}^{k-1}dt_i, \sum_{i=n_c}^{k}dt_i)$ , 并告知前端这一题的剩余时间是 $(\sum_{i=n_c}^{k}dt_i)-(t-t_c)$ .

#### 6.1.2 功能实现流程

#### 6.1.3 用户界面设计

#### 6.1.4 相关接口

#### 6.1.5 异常处理

### 6.2 功能 D2 实现

#### 6.2.1 功能简述

（超级）管理员可以创建比赛，点击创建比赛按钮后出现创建比赛弹窗。（超级）管理员需确定比赛名称，选择比赛开始时间、答题时间、是否为私密比赛、是否 rating 属性，选定赛题以创建比赛。

#### 6.2.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\D2_ga.png" alt="D2_ga" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 6.2.2 创建比赛功能流程图	<!--标题-->
    </center>
</div>

#### 6.2.3 用户界面设计

| 序号 | 类型   | 信息内容         | 信息表现 | 说明                                                          |
| ---- | ------ | ---------------- | -------- | ------------------------------------------------------------- |
| 1    | 输入框 | 题目类型         | 字符     | 输入本次比赛名称，必填                                        |
| 2    | 选项框 | 比赛开始时间     | 时间     | 选择比赛开始时间，必选                                        |
| 3    | 选项框 | 每题答题时间限制 | 选项     | 需要在规定时间内完成答题，必选                                |
| 4    | 单选框 | 是否为私密比赛   | 选项     | 若为私密比赛需设置参赛密码，否则所有用户均可参赛，必选        |
| 5    | 输入框 | 比赛密码         | 字符     | 私密比赛的密码                                                |
| 6    | 单选框 | 是否 rating      | 选项     | 告知用户该次比赛是否计入 rating，实际操作以赛后设置为准，必选 |
| 7    | 选项框 | 选择题目标签     | 选项     | 选择题目标签筛选题目                                          |
| 8    | 文本   | 显示所有题目     | 字符     | 供（超级）管理员勾选比赛的题目，必选                          |
| 9    | 单选   | 是否有序勾选     | 选项     | 若选择有序勾选则赛题顺序为勾选顺序，否则为题目编号顺序        |
| 10   | 按钮   | 加入比赛         | 按钮     | 将勾选题目加入比赛，最多将 30 个题目加入比赛                  |
| 11   | 按钮   | 创建比赛         | 按钮     | 点击后根据 1-10 的设置创建比赛                                |

#### 6.2.4 相关接口

| 序号 | 类型 | 接口名称 | 来源/文档编号 | 说明 |
| ---- | ---- | -------- | ------------- | ---- |
| 1    | 内部 |          |               |      |

#### 6.2.5 异常处理

| 序号 | 错误编码 | 错误信息             | 说明/处理办法                                                      |
| ---- | -------- | -------------------- | ------------------------------------------------------------------ |
| 1    | D2-E01   | 未输入比赛名称       | 比赛名称输入框失去焦点后无信息输入，提示输入比赛名称               |
| 2    | D2-E02   | 未输入比赛密码       | 若为私密比赛，比赛密码输入框失去焦点后无信息输入，提示输入比赛密码 |
| 3    | D2-E03   | 比赛密码长度不符     | 比赛密码长度小于 6 或大于 20，提示修改                             |
| 4    | D2-E04   | 未勾选比赛题目       | 点击“加入比赛”按钮时未有勾选题目，提示勾选题目                     |
| 5    | D2-E05   | 题目数量超过最大限制 | 点击加入比赛时超过最大题数限制，提示修改                                  |
| 6    | D2-E06   | 有未设置的比赛属性   | 点击创建比赛按钮后检测到有未设置的比赛属性，提示完善设置           |
| 7    | D2-E07   | 登录失效             | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面       |

### 6.3 功能 D3 实现

#### 6.3.1 功能简述

（超级）管理员可以在比赛管理功能处看到包含所有比赛信息的列表，点击每行比赛记录后的“排行榜”按钮可以查看对应比赛的排名情况，其中包含用户的正确里率和比赛用时（不一定），点击“结果分析”可以查看比赛结果分析，包括用户答题正确率、（用时）分布直方图，错题分布。

#### 6.3.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\D3_all_game.png" alt="D3_all_game" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 6.3.2 查看比赛排名与结果分析功能流程图	<!--标题-->
    </center>
</div>

#### 6.3.3 用户界面设计

| 序号 | 类型 | 信息内容 | 信息表现 | 说明                               |
| ---- | ---- | -------- | -------- | ---------------------------------- |
| 1    | 文本 | 比赛名称 | 字符     | 每次比赛的名称，显示在比赛信息栏中 |
| 2    | 文本 | 参赛人数 | 字符     | 每次比赛的人数，显示在比赛信息栏中 |
| 3    | 按钮 | 排行榜   | 按钮     | 点击后弹窗显示比赛排行榜           |
| 4    | 按钮 | 结果分析 | 按钮     | 点击后弹窗显示比赛结果分析         |

#### 6.3.4 相关接口

| 序号 | 类型 | 接口名称 | 来源/文档编号 | 说明 |
| ---- | ---- | -------- | ------------- | ---- |
| 1    | 内部 |          |               |      |

#### 6.3.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | D3-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

### 6.4 功能 D4 实现

#### 6.4.1 功能简述

（超级）管理员可以在赛后综合赛前设置和赛题情况，将该次比赛的排名计入 rating，“计入 rating”按钮在比赛信息列表中，该按钮仅可点击一次。点击后提示（超级）管理员是否确定加入 rating，确认后用户 rating 会根据该次比赛更新，且该次比赛的“计入 rating”按钮失效。一般情况下，赛后是否计入 rating 与赛前设置保持一致，若出现如出题事故等情况可酌情调整。

#### 6.4.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\D4_rating1.png" alt="D4_rating1" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 6.4.2 更新 rating 功能流程图	<!--标题-->
    </center>
</div>

#### 6.4.3 用户界面设计

| 序号 | 类型 | 信息内容    | 信息表现 | 说明                                                     |
| ---- | ---- | ----------- | -------- | -------------------------------------------------------- |
| 1    | 按钮 | 计入 rating | 字符     | 点击后将该次比赛排名计入 rating 中，显示在每行比赛记录中 |

#### 6.4.4 相关接口

| 序号 | 类型 | 接口名称 | 来源/文档编号 | 说明 |
| ---- | ---- | -------- | ------------- | ---- |
| 1    | 内部 |          |               |      |

#### 6.4.5 异常处理

| 序号 | 错误编码 | 错误信息 | 说明/处理办法                                                |
| ---- | -------- | -------- | ------------------------------------------------------------ |
| 1    | D4-E01   | 登录失效 | 操作后检测到当前 cookie 已过期，提示登录失效并跳转到登录界面 |

## 7 接口设计

接口定义请与后端讨论确定, 接口定义表格见`API.md`.

### 7.1 接口 1 定义(这些不着急写, 可以等 API 写完在这放一个精简版)

## 8 数据库设计
