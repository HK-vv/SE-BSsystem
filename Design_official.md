[TOC]

# BrainStorm 知识竞赛系统设计文档

## 1 版本历史

| 日期     | 版本 | 人员   | 更新内容                      |
| -------- | ---- | ------ | ----------------------------- |
| 22.03.26 | v0.0 | 赵子涵 | 创建文档及目录; 编写文档介绍. |
| 22.03.28 | v0.1 | 李昀泽 | 编辑功能 A 目录               |
| 22.03.28 | v0.2 | 刘硕   | 编写 A1 功能，修改功能 A 目录 |
| 22.03.28 | v0.3 | 李昀泽 | 编写 A2、A3、A4 功能          |
| 22.03.28 | v0.4 | 刘硕   | 编写 A5 功能，修改 A1 功能    |
| 22.03.29 | v0.5 | 黄辰麟 | 编写 A7 功能，编写 A8 功能    |
| 22.03.30 | v0.6 | 张瑞轩 | 编写接口设计相关内容          |

## 2 文档介绍

### 2.1 文档目的

本文档是由 BrainStorm 团队编写, 为 BrainStorm 知识竞赛系统编写的设计文档. 服务于使用和开发本系统的各种人群, 和执行评审的软工课程组.

文档对逻辑分类的各个功能具体描述了界面设计, 接口设计和主要的数据库设计.

望本文能带领读者了解系统的设计细节, 给开发人员提供明确的指导.

### 2.2 术语解释

| 缩写 | 解释                    |
| ---- | ----------------------- |
| BS   | BrainStorm 知识竞赛系统 |
|      |                         |
|      |                         |

### 2.3 参考文献

[1] OmniSci 团队，《设计报告》，北航计算机学院，2019.06.09.

## 3 用户信息管理功能(A)

| 子功能名称                     | 子功能代号 | 描述                                                                                                                     |
| ------------------------------ | ---------- | ------------------------------------------------------------------------------------------------------------------------ |
| 管理员账号登录功能             | A1         | （超级）管理员填写账号密码进行登录。                                                                                     |
| 创建、删除管理员账号功能       | A2         | 由超级管理员创建管理员账号并设定初始密码，管理员可自行修改个人密码。超级管理员可以删除管理员账号，但不能删除自己的账号。 |
| 重置管理员密码功能             | A3         | 超级管理员可将管理员密码重置为默认密码                                                                                   |
| （超级）管理员信息查询功能     | A4         | （超级）管理员可直接浏览系统中所有管理员的信息，并可按（超级）管理员用户名进行查询                                       |
| 微信小程序用户信息查询功能     | A5         | （超级）管理员可直接浏览所有小程序用户的信息，并支持根据用户名进行筛选                                                   |
| （超级）管理员个人信息修改功能 | A6         | （超级）管理员可在个人中心对个人信息进行修改 |
| 小程序用户端登入登出     | A7   | 用户绑定微信进行登入登出 |
| 小程序用户端修改个人信息 | A8   | 用户修改个人信息         |

### 3.1 功能 A1 实现

#### 3.1.1 功能简述

管理端支持（超级）管理员通过用户名和密码登录。前端对是否输入信息进行验证，如输入框失去焦点后无信息存留，则提示输入信息。如输入的用户名和密码信息正确则进入系统，否则给出错误信息提示。

#### 3.1.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\login.png" alt="login" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 3.1.2 （超级）管理员登录流程图	<!--标题-->
    </center>
</div>

#### 3.1.3 用户界面设计

| 序号 | 类型   | 信息内容     | 信息表现 | 说明                               |
| ---- | ------ | ------------ | -------- | ---------------------------------- |
| 1    | 输入框 | 用户名输入框 | 字符提示 | 输入已创建的用户名，显示在登录框中 |
| 2    | 输入框 | 密码输入框   | 字符提示 | 输入对应密码，显示在登录框中       |
| 3    | 按钮   | 登录         | 按钮提示 | 点击后可进入系统，显示在登录框中   |

#### 3.1.4 相关接口

| 序号 | 类型 | 接口名称              | 来源/文档编号 | 说明       |
| ---- | ---- | --------------------- | ------------- | ---------- |
| 1    | 内部 | /api/admin/auth/login | 8.1           | 管理员登录 |

#### 3.1.5 异常处理

| 序号 | 错误编码 | 错误信息         | 说明/处理办法                                              |
| ---- | -------- | ---------------- | ---------------------------------------------------------- |
| 1    | A1-E01   | 未输入用户名     | 用户名输入框失去焦点后无输入信息，提示输入用户名           |
| 2    | A1-E02   | 未输入密码       | 用户名输入框失去焦点后无输入信息，提示输入密码             |
| 3    | A1-E03   | 缺少输入项       | 点击登录后检测到未输入用户名或密码，提示输入必要表单项     |
| 4    | A1-E04   | 用户名或密码错误 | 点击登录后检测到用户名或密码密码错误，提示用户名或密码错误 |

### 3.2 功能 A2 实现

#### 3.2.1 功能简述

该功能具有基本的管理员账户的创建和删除功能，仅超级管理员拥有该功能权限。仅需填写被创建用户的用户名再点击确认按钮即可完成管理员账号创建，初始密码为系统默认密码。点击需要删除的管理员账户信息后面的删除按钮，并再次确认后即可删除。

#### 3.2.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\A2.jpg" alt="admin_add" style="zoom:75%;" />
    <br>		<!--换行-->
    图 3.2.2.1 创建管理员流程图	<!--标题-->
    </center>
</div>
<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\admin_delete.jpg" alt="admin_add" style="zoom:75%;" />
    <br>		<!--换行-->
    图 3.2.2.2 删除管理员流程图	<!--标题-->
    </center>
</div>

#### 3.2.3 用户界面设计

**创建管理员**
| 序号 | 类型 | 信息内容 | 信息表现 | 说明 |
| ---- | ---- | --------| ---------| -----|
| 1 | 文本 | 用户名输入框 | 字符提示| 遵顼字符及长度限制（6~20 个字符），显示在账户创建框里 |
| 2 | 文本 | 默认密码提示 | 字符提示 | 提示系统默认密码内容，显示在账户创建框里 |

**删除管理员**
| 序号 | 类型 | 信息内容 | 信息表现 | 说明 |
| ---- | ---- | --------| ---------| -----|
| 1 | 文本 | 确认信息 | 字符提示| 提示是否确认删除 |
| 2 | 按钮 | 确认/取消 | 按钮提示 | 选择是否确认删除 |

#### 3.2.4 相关接口

| 序号 | 类型 | 接口名称                 | 来源/文档编号 | 说明                                     |
| ---- | ---- | ------------------------ | ------------- | ---------------------------------------- |
| 1    | 内部 | /api/admin/admin_account | 8.3           | 创建、删除管理员账号，查看、修改个人信息 |

#### 3.2.5 异常处理

| 序号 | 错误编码 | 错误信息   | 说明/处理办法                  |
| ---- | -------- | ---------- | ------------------------------ |
| 1    | A2-E01   | 用户名过短 | 用户名小于 6 个字符，提示修改  |
| 2    | A2-E02   | 用户名过长 | 用户名大于 20 个字符，提示修改 |

### 3.3 功能 A3 实现

#### 3.3.1 功能简述

该功能具有基本的管理员密码重置功能，仅超级管理员拥有该功能权限。仅需点击需要重置的管理员账户信息后面的重置密码按钮，并再次确认后即可将相应管理员密码重置为系统默认密码。

#### 3.3.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\password_reset.jpg" alt="password_reset" style="zoom:75%;" />
    <br>		<!--换行-->
    图 3.3.2 重置管理员密码流程图	<!--标题-->
    </center>
</div>

#### 3.3.3 用户界面设计

| 序号 | 类型 | 信息内容  | 信息表现 | 说明                 |
| ---- | ---- | --------- | -------- | -------------------- |
| 1    | 文本 | 确认信息  | 字符提示 | 提示是否确认重置密码 |
| 2    | 按钮 | 确认/取消 | 按钮提示 | 选择是否确认重置密码 |

#### 3.3.4 相关接口

| 序号 | 类型 | 接口名称                                | 来源/文档编号 | 说明           |
| ---- | ---- | --------------------------------------- | ------------- | -------------- |
| 1    | 内部 | /api/admin/admin_account/reset_password | 8.4           | 重置管理员密码 |

#### 3.3.5 异常处理

无

### 3.4 功能 A4 实现

#### 3.4.1 功能简述

（超级）管理员点击用户信息管理中的“管理员”按钮，可查询到所有（超级）管理员的信息，并可根据用户名搜索（超级）管理员信息。（超级）管理员可以根据需求选择每页展示的（超级）管理员数量。

#### 3.4.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\list_admin.jpg" alt="password_reset" style="zoom:75%;" />
    <br>		<!--换行-->
    图 3.4.2 (超级)管理员信息查询流程图	<!--标题-->
    </center>
</div>

#### 3.4.3 用户界面设计

| 序号 | 类型       | 信息内容           | 信息表现 | 说明                             |
| ---- | ---------- | ------------------ | -------- | -------------------------------- |
| 1    | 文本       | 用户名             | 字符     | 展示所有（超级）管理员用户名信息 |
| 2    | 文本       | 管理员类型         | 字符     | 展示所有（超级）管理员类型       |
| 3    | 按钮       | 重置密码           | 按钮     |                                  |
| 4    | 按钮       | 删除               | 按钮     |                                  |
| 5    | 搜索输入框 | 用户名             | 字符     | 根据用户名搜索管理员信息         |
| 6    | 下拉选项框 | 每页用户数量选项框 | 选项     |                                  |

#### 3.4.4 相关接口

| 序号 | 类型 | 接口名称                      | 来源/文档编号 | 说明           |
| ---- | ---- | ----------------------------- | ------------- | -------------- |
| 1    | 内部 | /api/admin/admin_account/list | 8.5           | 列出管理员账号 |

#### 3.4.5 异常处理

无

### 3.5 功能 A5 实现

#### 3.5.1 功能简述

（超级）管理员点击用户信息管理功能中的“小程序用户”按钮，可查询到所有小程序用户的用户名和 rating，点击历次比赛表现可具体查看每位用户参与的所有比赛及排名。（超级）管理员可以根据需求选择每页显示的用户数量、根据用户名筛选检索用户信息、选择升序或降序排名。

#### 3.5.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\A5_view_user_information.png" alt="A5_view_user_information" style="zoom:60%;"/>
    <br>		<!--换行-->
    图 3.5.2 （超级）管理员查看小程序用户信息流程图	<!--标题-->
    </center>
</div>

#### 3.5.3 用户界面设计

| 序号 | 类型       | 信息内容         | 信息表现 | 说明                                                       |
| ---- | ---------- | ---------------- | -------- | ---------------------------------------------------------- |
| 1    | 文本       | 用户名           | 字符     | 小程序用户的用户名，显示在小程序用户信息栏中               |
| 2    | 文本       | rating           | 字符     | 小程序用户的 rating，显示在小程序用户信息栏中              |
| 3    | 按钮       | 历次比赛表现     | 按钮     | 点击弹窗展示用户历次比赛表现，按钮显示在小程序用户信息栏中 |
| 4    | 搜索输入框 | 用户名关键字     | 字符     | 根据用户名搜索用户信息，显示在小程序用户信息栏顶部         |
| 5    | 下拉选项框 | 默认、升序、降序 | 选项     | 选择用户排列方式，下拉选项框形式显示在小程序用户信息栏顶部 |
| 6    | 下拉选项框 | 每页用户数量     | 选项     | 选择每页用户数量，下拉选项框形式显示在小程序用户信息栏底部 |

#### 3.5.4 相关接口

| 序号 | 类型 | 接口名称                     | 来源/文档编号 | 说明         |
| ---- | ---- | ---------------------------- | ------------- | ------------ |
| 1    | 内部 | /api/admin/user_account/list | 8.6           | 列出用户账号 |

（这里还有一个查看用户历次比赛表现的接口）

#### 3.5.5 异常处理

无

### 3.6 功能 A6 实现

#### 3.6.1 功能简述

#### 3.6.2 功能实现流程

#### 3.6.3 用户界面设计

#### 3.6.4 相关接口

| 序号 | 类型 | 接口名称                                | 来源/文档编号 | 说明                                     |
| ---- | ---- | --------------------------------------- | ------------- | ---------------------------------------- |
| 1    | 内部 | /api/admin/admin_account                | 8.3           | 创建、删除管理员账号，查看、修改个人信息 |
| 2    | 内部 | /api/admin/admin_account/reset_password | 8.4           | 重置管理员密码                           |

#### 3.6.5 异常处理

### 3.7 功能A7实现

#### 3.7.1 功能简述

当用户在未登录状态时，用户点击菜单主页面登录按钮，弹出是否绑定弹窗，随后可选择绑定微信或返回；当用户在登录状态时，用户点击菜单主页面登录按钮，弹出是否解绑定弹窗，随后可选择解绑微信或返回。

#### 3.7.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\Design_official_3.7.2.png" alt="A5_view_user_information" style="zoom:60%;"/>
    </center>
</div>


#### 3.7.3 用户界面设计

| 序号 | 类型 | 信息内容              | 信息表现      | 说明                                            |
| ---- | ---- | --------------------- | ------------- | ----------------------------------------------- |
| 1    | 按钮 | 用户头像/“未登录”     | 圆形图片/字符 | 点击可出现登录或登出弹窗                        |
| 2    | 文本 | “请问是否登录/登出”   | 图片          | 弹窗提示文字                                    |
| 3    | 按钮 | “微信登陆”/“微信登出” | 图片          | 弹窗按钮：点击即可登录/登出，随后返回菜单主页面 |
| 4    | 按钮 | “取消”                | 图片          | 弹窗按钮：点击可关闭弹窗                        |

#### 3.7.4 相关接口

| 序号 | 类型 | 接口名称              | 来源/文档编号 | 说明     |
| ---- | ---- | --------------------- | ------------- | -------- |
| 1    | 内部 | /api/user/auth/login  |               | 用户登录 |
| 2    | 内部 | /api/user/auth/logout |               | 用户登出 |

#### 3.7.5 异常处理

### 3.8 功能A8实现

#### 3.8.1 功能简述

当用户在登录状态时，可点击菜单主页面更改信息按钮，弹出改变ID弹窗，随后可输入新ID或返回，输入新ID后点击确认即可改变ID并自动返回。

#### 3.8.2 功能实现流程

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="img\Design_official_3.8.2.png" alt="A5_view_user_information" style="zoom:60%;"/>
    </center>
</div>


#### 3.8.3 用户界面设计

| 序号 | 类型   | 信息内容       | 信息表现 | 说明                                     |
| ---- | ------ | -------------- | -------- | ---------------------------------------- |
| 1    | 按钮   | “修改用户信息” | 图片     | 点击可出现修改信息弹窗                   |
| 2    | 图片   | 微信头像       | 图片     | 弹窗图片：显示微信头像                   |
| 3    | 文本   | 原用户名       | 字符     | 弹窗文本：原用户名                       |
| 4    | 输入框 | 有限字符       | 字符     | 弹窗输入：可输入新用户名                 |
| 5    | 按钮   | “确认”         | 图片     | 弹窗按钮：点击即可确认新用户名并关闭弹窗 |
| 6    | 按钮   | “取消”         | 图片     | 弹窗按钮：点击可关闭弹窗                 |

#### 3.8.4 相关接口

| 序号 | 类型 | 接口名称          | 来源/文档编号 | 说明                   |
| ---- | ---- | ----------------- | ------------- | ---------------------- |
| 1    | 内部 | /api/user/profile |               | 用户查看、修改个人信息 |

#### 3.8.5 异常处理

## 4 题库管理功能(B)

## 5 自主组卷练习功能(C)

## 6 比赛功能(D)

## 7 答题功能(E)

## 8 接口设计

接口定义请与后端讨论确定

| 序号 | 类型 | 接口名称                                        | 文档编号 | 说明                                     |
| ---- | ---- | ----------------------------------------------- | -------- | ---------------------------------------- |
|      | 内部 | /api/admin/auth/login                           |          | 管理员登录                               |
|      | 内部 | /api/admin/auth/logout                          |          | 管理员登出                               |
|      | 内部 | /api/admin/admin_account                        |          | 创建、删除管理员账号，查看、修改个人信息 |
|      | 内部 | /api/admin/admin_account/reset_password         |          | 重置管理员密码                           |
|      | 内部 | /api/admin/admin_account/list                   |          | 列出管理员账号                           |
|      | 内部 | /api/admin/admin_account/integrity_verification |          | 检测管理员信息是否完整                   |
|      | 内部 | /api/admin/admin_account/issuper                |          | 检测是否为超级管理员                     |
|      | 内部 | /api/admin/user_account/list                    |          | 列出用户账号                             |
|      | 内部 | /api/admin/user_account/contest_history         |          | 列出用户比赛历史                         |
|      |      |                                                 |          |                                          |
|      | 内部 | /api/user/auth/login                            |          | 用户登录                                 |
|      | 内部 | /api/user/auth/logout                           |          | 用户登出                                 |
|      | 内部 | /api/user/profile                               |          | 用户查看、修改个人信息                   |
|      | 内部 | /api/user/exercise/collect                      |          | 自主组卷                                 |
|      | 内部 | /api/user/exercise/problem                      |          | 获取题面                                 |
|      | 内部 | /api/user/exercise/problem/check                |          | 验证答案                                 |

### 8.1 接口 1 定义(这些不着急写, 可以等 API 写完在这放一个精简版)

## 9 数据库设计
